/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, Output, EventEmitter, ElementRef, ViewChild } from '@angular/core';
import { NgbInputDatepicker } from '@ng-bootstrap/ng-bootstrap';
import { DateRange } from '../models/date-range';
import { NgbDateNativeAdapter } from '../services/NgbDateNativeAdapter';
export class DateRangePickerComponent {
    /**
     * @param {?} dateAdapter
     */
    constructor(dateAdapter) {
        this.dateAdapter = dateAdapter;
        this.disabled = false;
        this.dateRangeChange = new EventEmitter();
        this.isInside = date => date.after(this.fromDate) && date.before(this.toDate);
        this.isFrom = date => date.equals(this.fromDate);
        this.isTo = date => date.equals(this.toDate);
        this.isDisabled = date => date.after(this.max) || date.before(this.min);
        this.isInFuture = date => date.after(this.toDate);
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.fromDate = this.dateAdapter.fromModel(this.dateRange.start);
        this.toDate = this.dateAdapter.fromModel(this.dateRange.end);
        this.min = this.minDate ? this.dateAdapter.fromModel(this.minDate) : null;
        this.max = this.maxDate ? this.dateAdapter.fromModel(this.maxDate) : null;
        this.inputElRef.nativeElement.value = this.formatInputText();
        if (this.fromDate) {
            this.dp.startDate = {
                year: this.fromDate.year,
                month: this.fromDate.month
            };
        }
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (changes.dateRange || changes.disabled) {
            this.ngOnInit();
        }
    }
    /**
     * @param {?} date
     * @param {?} dp
     * @return {?}
     */
    onDateChange(date, dp) {
        if (!this.fromDate && !this.toDate) {
            this.fromDate = date;
            this.dateRange.start = this.dateAdapter.toModel(this.fromDate);
        }
        else if (this.fromDate && !this.toDate && date.after(this.fromDate)) {
            this.toDate = date;
            this.dateRange.end = this.dateAdapter.toModel(this.toDate);
            dp.close();
        }
        else {
            this.toDate = null;
            this.fromDate = date;
            this.dateRange.start = this.dateAdapter.toModel(this.fromDate);
            this.dateRange.end = null;
        }
        this.inputElRef.nativeElement.value = this.formatInputText();
        this.dateRangeChange.emit(this.dateRange);
    }
    /**
     * @private
     * @return {?}
     */
    formatInputText() {
        if (this.dateRange.start &&
            this.dateRange.end &&
            DateRange.isValidDate(this.dateRange.start) &&
            DateRange.isValidDate(this.dateRange.end)) {
            return `${this.dateRange.start.toLocaleDateString()} - ${this.dateRange.end.toLocaleDateString()}`;
        }
        return '';
    }
    /**
     * @param {?} date
     * @return {?}
     */
    isHovered(date) {
        return (this.fromDate &&
            !this.toDate &&
            this.hoveredDate &&
            date.after(this.fromDate) &&
            date.before(this.hoveredDate));
    }
    /**
     * @param {?} date
     * @return {?}
     */
    isWeekend(date) {
        /** @type {?} */
        const d = new Date(date.year, date.month - 1, date.day);
        return d.getDay() === 0 || d.getDay() === 6;
    }
}
DateRangePickerComponent.decorators = [
    { type: Component, args: [{
                selector: 'date-range-picker',
                template: "<div class=\"input-group\">\r\n  <input ngbDatepicker #dp=\"ngbDatepicker\" type=\"text\" class=\"form-control\" style=\"max-width:200px;\" readonly\r\n    [disabled]=\"disabled\" [autoClose]=\"false\" [displayMonths]=\"2\" [dayTemplate]=\"t\" [showWeekNumbers]=\"false\"\r\n    [markDisabled]=\"isDisabled\" [firstDayOfWeek]=\"7\" (click)=\"dp.toggle()\" (dateSelect)=\"onDateChange($event, dp)\">\r\n  <div class=\"input-group-append\">\r\n    <button class=\"btn btn-outline-secondary d-flex align-items-center\" (click)=\"dp.toggle()\" type=\"button\">\r\n      <svg aria-hidden=\"true\" role=\"icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 448 512\">\r\n        <path fill=\"currentColor\" d=\"M148 288h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6 0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6 0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v52h48c26.5 0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3 0 6-2.7 6-6z\"></path>\r\n      </svg>\r\n    </button>\r\n  </div>\r\n</div>\r\n\r\n<ng-template #t let-date=\"date\" let-focused=\"focused\" let-disabled=\"disabled\">\r\n  <span class=\"custom-day\" [class.focused]=\"focused\" [class.range]=\"isFrom(date) || isTo(date) || isInside(date) || isHovered(date)\"\r\n    [class.faded]=\"isHovered(date) || isInside(date)\" [class.weekend]=\"isWeekend(date)\" [class.disabled]=\"disabled\"\r\n    (mouseenter)=\"hoveredDate = date\" (mouseleave)=\"hoveredDate = null\">\r\n    {{ date.day }}\r\n  </span>\r\n</ng-template>\r\n",
                styles: [".custom-day{text-align:center;padding:.185rem .25rem;display:inline-block;height:2rem;width:2rem}.custom-day.focused{background-color:#e6e6e6}.custom-day.range,.custom-day:hover{background-color:#0275d8;color:#fff}.custom-day.faded{background-color:rgba(2,117,216,.5)}.custom-day.weekend{color:#ff6e6e}.custom-day.disabled{color:#c8cdd2}svg{width:1rem;height:1rem}"]
            }] }
];
/** @nocollapse */
DateRangePickerComponent.ctorParameters = () => [
    { type: NgbDateNativeAdapter }
];
DateRangePickerComponent.propDecorators = {
    dateRange: [{ type: Input }],
    minDate: [{ type: Input }],
    maxDate: [{ type: Input }],
    disabled: [{ type: Input }],
    dateRangeChange: [{ type: Output }],
    inputElRef: [{ type: ViewChild, args: ['dp', { read: ElementRef },] }],
    dp: [{ type: ViewChild, args: ['dp',] }]
};
if (false) {
    /** @type {?} */
    DateRangePickerComponent.prototype.dateRange;
    /** @type {?} */
    DateRangePickerComponent.prototype.minDate;
    /** @type {?} */
    DateRangePickerComponent.prototype.maxDate;
    /** @type {?} */
    DateRangePickerComponent.prototype.disabled;
    /** @type {?} */
    DateRangePickerComponent.prototype.dateRangeChange;
    /** @type {?} */
    DateRangePickerComponent.prototype.hoveredDate;
    /**
     * @type {?}
     * @private
     */
    DateRangePickerComponent.prototype.fromDate;
    /**
     * @type {?}
     * @private
     */
    DateRangePickerComponent.prototype.toDate;
    /**
     * @type {?}
     * @private
     */
    DateRangePickerComponent.prototype.min;
    /**
     * @type {?}
     * @private
     */
    DateRangePickerComponent.prototype.max;
    /**
     * @type {?}
     * @private
     */
    DateRangePickerComponent.prototype.inputElRef;
    /**
     * @type {?}
     * @private
     */
    DateRangePickerComponent.prototype.dp;
    /** @type {?} */
    DateRangePickerComponent.prototype.isInside;
    /** @type {?} */
    DateRangePickerComponent.prototype.isFrom;
    /** @type {?} */
    DateRangePickerComponent.prototype.isTo;
    /** @type {?} */
    DateRangePickerComponent.prototype.isDisabled;
    /** @type {?} */
    DateRangePickerComponent.prototype.isInFuture;
    /**
     * @type {?}
     * @private
     */
    DateRangePickerComponent.prototype.dateAdapter;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0ZS1yYW5nZS1waWNrZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vQHVpb3dhL2RhdGUtcmFuZ2UtcGlja2VyLyIsInNvdXJjZXMiOlsibGliL2RhdGUtcmFuZ2UtcGlja2VyL2RhdGUtcmFuZ2UtcGlja2VyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFFVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixVQUFVLEVBQ1YsU0FBUyxFQUdWLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxrQkFBa0IsRUFBVyxNQUFNLDRCQUE0QixDQUFDO0FBQ3pFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUNqRCxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQU94RSxNQUFNLE9BQU8sd0JBQXdCOzs7O0lBc0JuQyxZQUE2QixXQUFpQztRQUFqQyxnQkFBVyxHQUFYLFdBQVcsQ0FBc0I7UUFkOUQsYUFBUSxHQUFLLEtBQUssQ0FBQztRQUVuQixvQkFBZSxHQUFHLElBQUksWUFBWSxFQUFhLENBQUM7UUF5RWhELGFBQVEsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3pFLFdBQU0sR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQzVDLFNBQUksR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBS3hDLGVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsSUFB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d0JBUTFCLEtBQUs7c0JBRUwsS0FBSztzQkFFTCxLQUFLO3VCQUVMLEtBQUs7OEJBRUwsTUFBTTt5QkFRTixTQUFTLFNBQUMsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRTtpQkFFcEMsU0FBUyxTQUFDLElBQUk7Ozs7SUFsQmYsNkNBQ3FCOztJQUNyQiwyQ0FDZTs7SUFDZiwyQ0FDZTs7SUFDZiw0Q0FDbUI7O0lBQ25CLG1EQUNnRDs7SUFDaEQsK0NBQXFCOzs7OztJQUVyQiw0Q0FBMEI7Ozs7O0lBQzFCLDBDQUF3Qjs7Ozs7SUFDeEIsdUNBQTRCOzs7OztJQUM1Qix1Q0FBNEI7Ozs7O0lBQzVCLDhDQUMrQjs7Ozs7SUFDL0Isc0NBQytCOztJQStEL0IsNENBQXlFOztJQUN6RSwwQ0FBNEM7O0lBQzVDLHdDQUF3Qzs7SUFLeEMsOENBQW1FOztJQUNuRSw4Q0FBNkM7Ozs7O0lBckVqQywrQ0FBa0QiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xyXG4gIENvbXBvbmVudCxcclxuICBPbkluaXQsXHJcbiAgSW5wdXQsXHJcbiAgT3V0cHV0LFxyXG4gIEV2ZW50RW1pdHRlcixcclxuICBFbGVtZW50UmVmLFxyXG4gIFZpZXdDaGlsZCxcclxuICBPbkNoYW5nZXMsXHJcbiAgU2ltcGxlQ2hhbmdlc1xyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQgeyBOZ2JJbnB1dERhdGVwaWNrZXIsIE5nYkRhdGUgfSBmcm9tICdAbmctYm9vdHN0cmFwL25nLWJvb3RzdHJhcCc7XHJcbmltcG9ydCB7IERhdGVSYW5nZSB9IGZyb20gJy4uL21vZGVscy9kYXRlLXJhbmdlJztcclxuaW1wb3J0IHsgTmdiRGF0ZU5hdGl2ZUFkYXB0ZXIgfSBmcm9tICcuLi9zZXJ2aWNlcy9OZ2JEYXRlTmF0aXZlQWRhcHRlcic7XHJcblxyXG5AQ29tcG9uZW50KHtcclxuICBzZWxlY3RvcjogJ2RhdGUtcmFuZ2UtcGlja2VyJyxcclxuICB0ZW1wbGF0ZVVybDogJy4vZGF0ZS1yYW5nZS1waWNrZXIuY29tcG9uZW50Lmh0bWwnLFxyXG4gIHN0eWxlVXJsczogWycuL2RhdGUtcmFuZ2UtcGlja2VyLmNvbXBvbmVudC5jc3MnXVxyXG59KVxyXG5leHBvcnQgY2xhc3MgRGF0ZVJhbmdlUGlja2VyQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xyXG4gIEBJbnB1dCgpXHJcbiAgZGF0ZVJhbmdlOiBEYXRlUmFuZ2U7XHJcbiAgQElucHV0KClcclxuICBtaW5EYXRlPzogRGF0ZTtcclxuICBASW5wdXQoKVxyXG4gIG1heERhdGU/OiBEYXRlO1xyXG4gIEBJbnB1dCgpXHJcbiAgZGlzYWJsZWQgPyA9IGZhbHNlO1xyXG4gIEBPdXRwdXQoKVxyXG4gIGRhdGVSYW5nZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8RGF0ZVJhbmdlPigpO1xyXG4gIGhvdmVyZWREYXRlOiBOZ2JEYXRlO1xyXG5cclxuICBwcml2YXRlIGZyb21EYXRlOiBOZ2JEYXRlO1xyXG4gIHByaXZhdGUgdG9EYXRlOiBOZ2JEYXRlO1xyXG4gIHByaXZhdGUgbWluOiBOZ2JEYXRlIHwgbnVsbDtcclxuICBwcml2YXRlIG1heDogTmdiRGF0ZSB8IG51bGw7XHJcbiAgQFZpZXdDaGlsZCgnZHAnLCB7IHJlYWQ6IEVsZW1lbnRSZWYgfSlcclxuICBwcml2YXRlIGlucHV0RWxSZWY6IEVsZW1lbnRSZWY7XHJcbiAgQFZpZXdDaGlsZCgnZHAnKVxyXG4gIHByaXZhdGUgZHA6IE5nYklucHV0RGF0ZXBpY2tlcjtcclxuXHJcbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBkYXRlQWRhcHRlcjogTmdiRGF0ZU5hdGl2ZUFkYXB0ZXIpIHt9XHJcblxyXG4gIG5nT25Jbml0KCkge1xyXG4gICAgdGhpcy5mcm9tRGF0ZSA9IHRoaXMuZGF0ZUFkYXB0ZXIuZnJvbU1vZGVsKHRoaXMuZGF0ZVJhbmdlLnN0YXJ0KTtcclxuICAgIHRoaXMudG9EYXRlID0gdGhpcy5kYXRlQWRhcHRlci5mcm9tTW9kZWwodGhpcy5kYXRlUmFuZ2UuZW5kKTtcclxuICAgIHRoaXMubWluID0gdGhpcy5taW5EYXRlID8gdGhpcy5kYXRlQWRhcHRlci5mcm9tTW9kZWwodGhpcy5taW5EYXRlKSA6IG51bGw7XHJcbiAgICB0aGlzLm1heCA9IHRoaXMubWF4RGF0ZSA/IHRoaXMuZGF0ZUFkYXB0ZXIuZnJvbU1vZGVsKHRoaXMubWF4RGF0ZSkgOiBudWxsO1xyXG4gICAgdGhpcy5pbnB1dEVsUmVmLm5hdGl2ZUVsZW1lbnQudmFsdWUgPSB0aGlzLmZvcm1hdElucHV0VGV4dCgpO1xyXG4gICAgaWYgKHRoaXMuZnJvbURhdGUpIHtcclxuICAgICAgdGhpcy5kcC5zdGFydERhdGUgPSB7XHJcbiAgICAgICAgeWVhcjogdGhpcy5mcm9tRGF0ZS55ZWFyLFxyXG4gICAgICAgIG1vbnRoOiB0aGlzLmZyb21EYXRlLm1vbnRoXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpOiB2b2lkIHtcclxuICAgIGlmIChjaGFuZ2VzLmRhdGVSYW5nZSB8fCBjaGFuZ2VzLmRpc2FibGVkKSB7XHJcbiAgICAgIHRoaXMubmdPbkluaXQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIG9uRGF0ZUNoYW5nZShkYXRlOiBOZ2JEYXRlLCBkcDogTmdiSW5wdXREYXRlcGlja2VyKSB7XHJcbiAgICBpZiAoIXRoaXMuZnJvbURhdGUgJiYgIXRoaXMudG9EYXRlKSB7XHJcbiAgICAgIHRoaXMuZnJvbURhdGUgPSBkYXRlO1xyXG4gICAgICB0aGlzLmRhdGVSYW5nZS5zdGFydCA9IHRoaXMuZGF0ZUFkYXB0ZXIudG9Nb2RlbCh0aGlzLmZyb21EYXRlKTtcclxuICAgIH0gZWxzZSBpZiAodGhpcy5mcm9tRGF0ZSAmJiAhdGhpcy50b0RhdGUgJiYgZGF0ZS5hZnRlcih0aGlzLmZyb21EYXRlKSkge1xyXG4gICAgICB0aGlzLnRvRGF0ZSA9IGRhdGU7XHJcbiAgICAgIHRoaXMuZGF0ZVJhbmdlLmVuZCA9IHRoaXMuZGF0ZUFkYXB0ZXIudG9Nb2RlbCh0aGlzLnRvRGF0ZSk7XHJcbiAgICAgIGRwLmNsb3NlKCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLnRvRGF0ZSA9IG51bGw7XHJcbiAgICAgIHRoaXMuZnJvbURhdGUgPSBkYXRlO1xyXG4gICAgICB0aGlzLmRhdGVSYW5nZS5zdGFydCA9IHRoaXMuZGF0ZUFkYXB0ZXIudG9Nb2RlbCh0aGlzLmZyb21EYXRlKTtcclxuICAgICAgdGhpcy5kYXRlUmFuZ2UuZW5kID0gbnVsbDtcclxuICAgIH1cclxuICAgIHRoaXMuaW5wdXRFbFJlZi5uYXRpdmVFbGVtZW50LnZhbHVlID0gdGhpcy5mb3JtYXRJbnB1dFRleHQoKTtcclxuICAgIHRoaXMuZGF0ZVJhbmdlQ2hhbmdlLmVtaXQodGhpcy5kYXRlUmFuZ2UpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBmb3JtYXRJbnB1dFRleHQoKTogc3RyaW5nIHtcclxuICAgIGlmIChcclxuICAgICAgdGhpcy5kYXRlUmFuZ2Uuc3RhcnQgJiZcclxuICAgICAgdGhpcy5kYXRlUmFuZ2UuZW5kICYmXHJcbiAgICAgIERhdGVSYW5nZS5pc1ZhbGlkRGF0ZSh0aGlzLmRhdGVSYW5nZS5zdGFydCkgJiZcclxuICAgICAgRGF0ZVJhbmdlLmlzVmFsaWREYXRlKHRoaXMuZGF0ZVJhbmdlLmVuZClcclxuICAgICkge1xyXG4gICAgICByZXR1cm4gYCR7dGhpcy5kYXRlUmFuZ2Uuc3RhcnQudG9Mb2NhbGVEYXRlU3RyaW5nKCl9IC0gJHt0aGlzLmRhdGVSYW5nZS5lbmQudG9Mb2NhbGVEYXRlU3RyaW5nKCl9YDtcclxuICAgIH1cclxuICAgIHJldHVybiAnJztcclxuICB9XHJcblxyXG4gIGlzSG92ZXJlZChkYXRlKSB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICB0aGlzLmZyb21EYXRlICYmXHJcbiAgICAgICF0aGlzLnRvRGF0ZSAmJlxyXG4gICAgICB0aGlzLmhvdmVyZWREYXRlICYmXHJcbiAgICAgIGRhdGUuYWZ0ZXIodGhpcy5mcm9tRGF0ZSkgJiZcclxuICAgICAgZGF0ZS5iZWZvcmUodGhpcy5ob3ZlcmVkRGF0ZSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBpc0luc2lkZSA9IGRhdGUgPT4gZGF0ZS5hZnRlcih0aGlzLmZyb21EYXRlKSAmJiBkYXRlLmJlZm9yZSh0aGlzLnRvRGF0ZSk7XHJcbiAgaXNGcm9tID0gZGF0ZSA9PiBkYXRlLmVxdWFscyh0aGlzLmZyb21EYXRlKTtcclxuICBpc1RvID0gZGF0ZSA9PiBkYXRlLmVxdWFscyh0aGlzLnRvRGF0ZSk7XHJcbiAgaXNXZWVrZW5kKGRhdGU6IE5nYkRhdGUpIHtcclxuICAgIGNvbnN0IGQgPSBuZXcgRGF0ZShkYXRlLnllYXIsIGRhdGUubW9udGggLSAxLCBkYXRlLmRheSk7XHJcbiAgICByZXR1cm4gZC5nZXREYXkoKSA9PT0gMCB8fCBkLmdldERheSgpID09PSA2O1xyXG4gIH1cclxuICBpc0Rpc2FibGVkID0gZGF0ZSA9PiBkYXRlLmFmdGVyKHRoaXMubWF4KSB8fCBkYXRlLmJlZm9yZSh0aGlzLm1pbik7XHJcbiAgaXNJbkZ1dHVyZSA9IGRhdGUgPT4gZGF0ZS5hZnRlcih0aGlzLnRvRGF0ZSk7XHJcbn1cclxuIl19