import * as tslib_1 from "tslib";
import { Injectable } from "@angular/core";
import { NgxDatetimeRangePickerConstants } from "./ngx-datetime-range-picker.constants";
import * as i0 from "@angular/core";
var moment = require("moment");
var _ = require("lodash");
var DEFAULT_TYPE = NgxDatetimeRangePickerConstants.DEFAULT.TYPE;
var DEFAULT_INPUT_CLASS = NgxDatetimeRangePickerConstants.DEFAULT.INPUT_CLASS;
var DEFAULT_DATE_FROMAT = NgxDatetimeRangePickerConstants.DEFAULT.DATE_FROMAT;
var DEFAULT_TIME_FORMAT = NgxDatetimeRangePickerConstants.DEFAULT.TIME_FORMAT;
var DEFAULT_START_DATE = NgxDatetimeRangePickerConstants.DEFAULT.START_DATE;
var DEFAULT_END_DATE = NgxDatetimeRangePickerConstants.DEFAULT.END_DATE;
var DEFAULT_MIN_DATE = NgxDatetimeRangePickerConstants.DEFAULT.MIN_DATE;
var DEFAULT_MAX_DATE = NgxDatetimeRangePickerConstants.DEFAULT.MAX_DATE;
var DEFAULT_START_TIME = NgxDatetimeRangePickerConstants.DEFAULT.START_TIME;
var DEFAULT_END_TIME = NgxDatetimeRangePickerConstants.DEFAULT.END_TIME;
var DEFAULT_MODEL_KEYS = NgxDatetimeRangePickerConstants.DEFAULT.MODEL_KEYS;
var MONTHS_AVAILABLE = NgxDatetimeRangePickerConstants.CONSTANT.MONTHS_AVAILABLE;
var DEFAULT_TIMEZONE_CODE = NgxDatetimeRangePickerConstants.DEFAULT.TZ_CODE;
var EU_TZ_CODE = NgxDatetimeRangePickerConstants.CONSTANT.EU_TZ_CODE;
var TZ_NAMES = NgxDatetimeRangePickerConstants.CONSTANT.TZ_NAMES;
var NgxDatetimeRangePickerService = /** @class */ (function () {
    function NgxDatetimeRangePickerService() {
    }
    NgxDatetimeRangePickerService.prototype.getNotAvailableText = function () {
        return "N/A";
    };
    NgxDatetimeRangePickerService.prototype.getDefaultAriaLabelOptions = function () {
        return {
            inputField: "Date Range Input Field"
        };
    };
    NgxDatetimeRangePickerService.prototype.getDefaultOptions = function () {
        return {
            dateArray: [],
            startDate: DEFAULT_START_DATE,
            endDate: DEFAULT_END_DATE,
            minDate: DEFAULT_MIN_DATE,
            maxDate: DEFAULT_MAX_DATE,
            startTime: DEFAULT_START_TIME,
            endTime: DEFAULT_END_TIME
        };
    };
    NgxDatetimeRangePickerService.prototype.getDefaultSettings = function () {
        return {
            type: DEFAULT_TYPE,
            modelKeys: DEFAULT_MODEL_KEYS,
            selectedModel: undefined,
            showTimezoneSelect: false,
            useLocalTimezone: false,
            timePicker: false,
            inputClass: DEFAULT_INPUT_CLASS,
            inputDateFormat: null,
            viewDateFormat: DEFAULT_DATE_FROMAT,
            outputDateFormat: DEFAULT_DATE_FROMAT,
            singleDatePicker: false,
            componentDisabled: false,
            placeholder: "Select Date",
            showRowNumber: true,
            availableRanges: {},
            showRanges: true,
            disableWeekends: false,
            disableWeekdays: false,
            retailCalendar: false,
            displayBeginDate: false,
            displayEndDate: false,
            ariaLabels: this.getDefaultAriaLabelOptions()
        };
    };
    NgxDatetimeRangePickerService.prototype.formatDateToDefaultFormat = function (date, format) {
        if (format === void 0) { format = DEFAULT_DATE_FROMAT; }
        var fromattedDate = null;
        if (date) {
            if (!isNaN(Number(date))) {
                fromattedDate = moment(date).format(DEFAULT_DATE_FROMAT);
            }
            else {
                if (!format) {
                    format = moment(date)._f;
                }
                else {
                    if (format !== moment(date)._f) {
                        console.warn("ERR_NGX_DATETIME_RANGE_PICKER: inputDateFormat !== dateFormat");
                    }
                }
                if (!format) {
                    console.warn("ERR_NGX_DATETIME_RANGE_PICKER: The provided date is in unknown format. Pass the format or pass the date in known format");
                }
                fromattedDate = moment(date, format).format(DEFAULT_DATE_FROMAT);
            }
        }
        return fromattedDate;
    };
    NgxDatetimeRangePickerService.prototype.formatTimeToDefaultFormat = function (time) {
        var formattedTime = null;
        if (time) {
            if (time.indexOf(":") > -1) {
                if (time.indexOf("AM") > -1 || time.indexOf("PM") > -1) {
                    formattedTime = moment(time, "h:mm A").format(DEFAULT_TIME_FORMAT);
                }
                else {
                    formattedTime = time;
                }
            }
            else {
                console.warn("ERR_NGX_DATETIME_RANGE_PICKER: The provided time is not in correct format. Format: HH:mm or hh:mm A");
            }
        }
        return formattedTime;
    };
    NgxDatetimeRangePickerService.prototype.getFrequencyColumnHeader = function (type) {
        return (function () {
            switch (type) {
                case "daily":
                    return "W#";
                case "weekly":
                    return "";
                case "monthly":
                    return "Q#";
                case "quarterly":
                    return "Year";
                case "yearly":
                    return "";
            }
        })();
    };
    NgxDatetimeRangePickerService.prototype.getCalendarRowNumberText = function (type, number) {
        return (function () {
            switch (type) {
                case "daily":
                    return "W" + number;
                case "weekly":
                    return "";
                case "monthly":
                    return "Q" + number;
                case "quarterly":
                    return "" + number;
                case "yearly":
                    return "";
            }
        })();
    };
    NgxDatetimeRangePickerService.prototype.createDefaultRanges = function (config) {
        var ranges = {};
        var type = config.type;
        var maxDate = _.cloneDeep(config.maxDate);
        var formattedMaxDate = this.formatDateToDefaultFormat(maxDate, DEFAULT_DATE_FROMAT);
        if (type === "daily") {
            ranges["Last 7 Days"] = {
                startDate: moment(formattedMaxDate, DEFAULT_DATE_FROMAT)
                    .subtract(6, "days")
                    .format(DEFAULT_DATE_FROMAT),
                endDate: formattedMaxDate
            };
            ranges["Last 30 Days"] = {
                startDate: moment(formattedMaxDate, DEFAULT_DATE_FROMAT)
                    .subtract(29, "days")
                    .format(DEFAULT_DATE_FROMAT),
                endDate: formattedMaxDate
            };
            ranges["Last 90 Days"] = {
                startDate: moment(formattedMaxDate, DEFAULT_DATE_FROMAT)
                    .subtract(89, "days")
                    .format(DEFAULT_DATE_FROMAT),
                endDate: formattedMaxDate
            };
        }
        else if (type === "weekly") {
            ranges["Last 4 Weeks"] = {
                startDate: moment(formattedMaxDate, DEFAULT_DATE_FROMAT)
                    .subtract(3, "weeks")
                    .format(DEFAULT_DATE_FROMAT),
                endDate: formattedMaxDate
            };
            ranges["Last 13 Weeks"] = {
                startDate: moment(formattedMaxDate, DEFAULT_DATE_FROMAT)
                    .subtract(12, "weeks")
                    .format(DEFAULT_DATE_FROMAT),
                endDate: formattedMaxDate
            };
            ranges["Last 26 Weeks"] = {
                startDate: moment(formattedMaxDate, DEFAULT_DATE_FROMAT)
                    .subtract(25, "weeks")
                    .format(DEFAULT_DATE_FROMAT),
                endDate: formattedMaxDate
            };
        }
        else if (type === "monthly") {
            // if(retailCalendar) ? subtract(3, 'months')....so on for 'Last 3 Months'....so on
            ranges["Last 3 Months"] = {
                startDate: moment(formattedMaxDate, DEFAULT_DATE_FROMAT)
                    .subtract(2, "months")
                    .format(DEFAULT_DATE_FROMAT),
                endDate: formattedMaxDate
            };
            ranges["Last 6 Months"] = {
                startDate: moment(formattedMaxDate, DEFAULT_DATE_FROMAT)
                    .subtract(5, "months")
                    .format(DEFAULT_DATE_FROMAT),
                endDate: formattedMaxDate
            };
            ranges["Last 9 Months"] = {
                startDate: moment(formattedMaxDate, DEFAULT_DATE_FROMAT)
                    .subtract(8, "months")
                    .format(DEFAULT_DATE_FROMAT),
                endDate: formattedMaxDate
            };
        }
        else if (type === "quarterly") {
            // if(retailCalendar) ? subtract(1, 'quarters')....so on for 'Last 2 Quarters'....so on
            ranges["Last 2 Quarters"] = {
                startDate: moment(formattedMaxDate, DEFAULT_DATE_FROMAT)
                    .subtract(1, "quarters")
                    .format(DEFAULT_DATE_FROMAT),
                endDate: formattedMaxDate
            };
            ranges["Last 4 Quarters"] = {
                startDate: moment(formattedMaxDate, DEFAULT_DATE_FROMAT)
                    .subtract(3, "quarters")
                    .format(DEFAULT_DATE_FROMAT),
                endDate: formattedMaxDate
            };
        }
        else if (type === "yearly") {
            ranges["Last Year"] = {
                startDate: moment(formattedMaxDate, DEFAULT_DATE_FROMAT)
                    .subtract(1, "year")
                    .format(DEFAULT_DATE_FROMAT),
                endDate: formattedMaxDate
            };
        }
        ranges["Custom Range"] = { startDate: null, endDate: null };
        return ranges;
    };
    NgxDatetimeRangePickerService.prototype.getSanitizedDateArray = function (config) {
        var sanitizedDateArray = [];
        var type = config.type;
        var dateArray = config.dateArray;
        var inputDateFormat = config.inputDateFormat;
        // dateArray can have nulls
        _.forEach(dateArray, function (date) {
            if (date) {
                var format = null;
                if (isNaN(Number(date))) {
                    if (inputDateFormat) {
                        format = inputDateFormat;
                    }
                    else {
                        format = moment(date)._f;
                    }
                }
                if (inputDateFormat !== moment(date)._f) {
                    console.warn("ERR_NGX_DATETIME_RANGE_PICKER: inputDateFormat !== dateFormat in dateArray. Converted dates might not be as expected");
                }
                var value = format ? moment(date, format).format(format) : moment(date).valueOf();
                if (type === "weekly") {
                    value = format
                        ? moment(date, format)
                            .endOf("week")
                            .format(format)
                        : moment(date)
                            .endOf("week")
                            .valueOf();
                }
                else if (type === "monthly") {
                    value = format
                        ? moment(date, format)
                            .endOf("month")
                            .format(format)
                        : moment(date)
                            .endOf("month")
                            .valueOf();
                }
                else if (type === "quarterly") {
                    value = format
                        ? moment(date, format)
                            .endOf("quarter")
                            .format(format)
                        : moment(date)
                            .endOf("quarter")
                            .valueOf();
                }
                else if (type === "yearly") {
                    value = format
                        ? moment(date, format)
                            .endOf("year")
                            .format(format)
                        : moment(date)
                            .endOf("year")
                            .valueOf();
                }
                if (value) {
                    sanitizedDateArray.push(value);
                }
                else {
                    console.warn("ERR_NGX_DATETIME_RANGE_PICKER: dateArray values are in unknown format. Pass the format or pass the dates in known format");
                }
            }
        });
        return _.uniqBy(sanitizedDateArray);
    };
    NgxDatetimeRangePickerService.prototype.getNumberOfWeeks = function (date) {
        var numberOfWeeks = null;
        if (date) {
            var monthStart = moment(date, DEFAULT_DATE_FROMAT)
                .startOf("month")
                .day();
            var monthEnd = Number(moment(date, DEFAULT_DATE_FROMAT)
                .endOf("month")
                .format("D"));
            numberOfWeeks = Math.ceil((monthStart + monthEnd) / 7);
        }
        return numberOfWeeks;
    };
    NgxDatetimeRangePickerService.prototype.getYearlyWeekCount = function (year, retailCalendar) {
        var weekCount = null;
        if (year) {
            var yearStartDate = moment(year, "YYYY")
                .startOf("year")
                .format(DEFAULT_DATE_FROMAT);
            var yearEndDate = moment(year, "YYYY")
                .endOf("year")
                .format(DEFAULT_DATE_FROMAT);
            var yearEndWeekEndDate = moment(yearEndDate, DEFAULT_DATE_FROMAT)
                .startOf("week")
                .format(DEFAULT_DATE_FROMAT);
            var yearStartWeekEndDate = moment(yearStartDate, DEFAULT_DATE_FROMAT)
                .endOf("week")
                .format(DEFAULT_DATE_FROMAT);
            var yearSartWeekNumber = this.getWeekNumber(yearStartWeekEndDate);
            var yearEndWeekNumber = this.getWeekNumber(yearEndWeekEndDate);
            weekCount = yearEndWeekNumber - yearSartWeekNumber + 1;
        }
        return weekCount;
    };
    NgxDatetimeRangePickerService.prototype.getMonthsAvailable = function (minDate, maxDate, selectedYear) {
        var months = [];
        if (minDate && maxDate && selectedYear) {
            var minDatems = moment(minDate, DEFAULT_DATE_FROMAT).valueOf();
            var maxDatems = moment(maxDate, DEFAULT_DATE_FROMAT).valueOf();
            var yearStartms = moment()
                .year(selectedYear)
                .startOf("year")
                .valueOf();
            var yearEndms = moment()
                .year(selectedYear)
                .endOf("year")
                .valueOf();
            if (minDatems < yearStartms) {
                minDatems = yearStartms;
            }
            if (maxDatems > yearEndms) {
                maxDatems = yearEndms;
            }
            var minDateMonthNumber = moment(minDatems).month();
            var diff = moment(maxDatems).diff(moment(minDatems), "months");
            var maxMonths = diff < MONTHS_AVAILABLE.length ? diff : MONTHS_AVAILABLE.length;
            for (var i = 0; i <= maxMonths; i++) {
                if (minDateMonthNumber >= MONTHS_AVAILABLE.length) {
                    months.push(MONTHS_AVAILABLE[minDateMonthNumber - MONTHS_AVAILABLE.length]);
                }
                else {
                    months.push(MONTHS_AVAILABLE[minDateMonthNumber]);
                }
                minDateMonthNumber++;
            }
        }
        return months;
    };
    NgxDatetimeRangePickerService.prototype.getYearsAvailable = function (config) {
        var minDate = config ? config.minDate : "";
        var maxDate = config ? config.maxDate : "";
        var years = [];
        if (minDate && maxDate) {
            var minYear = Number(this.getSelectedYear(config, minDate, "left"));
            var maxYear = Number(this.getSelectedYear(config, maxDate, "right"));
            var diff = maxYear - minYear;
            for (var i = 0; i <= diff; i++) {
                years.push("" + (minYear + i));
            }
        }
        return years.reverse();
    };
    NgxDatetimeRangePickerService.prototype.isDateAvailable = function (date, minDate, maxDate, startDate, endDate, monthStartDate, monthEndDate, config) {
        var available = false;
        var type = config.type;
        var dateArray = config.dateArray ? config.dateArray : [];
        var inputDateFormat = config.inputDateFormat;
        var disableWeekends = config.disableWeekends;
        var disableWeekdays = config.disableWeekdays;
        if (type === "daily") {
            minDate = minDate > monthStartDate ? minDate : monthStartDate;
            maxDate = maxDate < monthEndDate ? maxDate : monthEndDate;
        }
        // if(date === minDate
        //     || date === maxDate) {
        //   available = true;
        // }
        if (date >= minDate && date <= maxDate) {
            if (dateArray.length > 0) {
                available = _.some(dateArray, function (d) {
                    var format = null;
                    if (isNaN(Number(date))) {
                        if (inputDateFormat) {
                            format = inputDateFormat;
                        }
                        else {
                            format = moment(date)._f;
                        }
                    }
                    return moment(d, format).valueOf() === date;
                });
            }
            else {
                available = true;
            }
            if (available) {
                if (disableWeekends) {
                    available = !this.isWeekend(date);
                }
                if (disableWeekdays) {
                    available = !this.isWeekday(date);
                }
            }
        }
        return available;
    };
    NgxDatetimeRangePickerService.prototype.isDateInRange = function (date, minDate, maxDate, startDate, endDate, monthStartDate, monthEndDate, available, config) {
        var inRange = false;
        var type = config.type;
        var singleDatePicker = config.singleDatePicker;
        if (!singleDatePicker) {
            if (type === "daily") {
                minDate = monthStartDate;
                maxDate = monthEndDate;
            }
            if (date >= startDate && date <= endDate && date >= minDate && date <= maxDate) {
                if (available) {
                    inRange = true;
                }
            }
        }
        return inRange;
    };
    NgxDatetimeRangePickerService.prototype.isDateActive = function (date, startDate, endDate, side) {
        var active = false;
        if ((date === startDate && side === "left") || (date === endDate && side === "right")) {
            active = true;
        }
        return active;
    };
    NgxDatetimeRangePickerService.prototype.isDateToday = function (date, config) {
        var today = false;
        var todayDate = moment()
            .startOf("day")
            .valueOf();
        var type = config.type;
        var firstLastDay = this.getFirstLastDay(moment(todayDate).format(DEFAULT_DATE_FROMAT), type);
        var firstDay = moment(firstLastDay.firstDay, DEFAULT_DATE_FROMAT).valueOf();
        var lastDay = moment(firstLastDay.lastDay, DEFAULT_DATE_FROMAT).valueOf();
        if (date >= firstDay && date <= lastDay) {
            today = true;
        }
        return today;
    };
    NgxDatetimeRangePickerService.prototype.isWeekday = function (date, format) {
        return !this.isWeekend(date, format);
    };
    NgxDatetimeRangePickerService.prototype.isWeekend = function (date, format) {
        if (!format) {
            format = null;
        }
        var day = moment(date, format).day();
        return day === 0 || day === 6 ? true : false;
    };
    NgxDatetimeRangePickerService.prototype.getCalendarRowVariables = function (options) {
        var variables = {};
        var type = options.type;
        var monthStartWeekNumber = options.monthStartWeekNumber;
        var dateRows = options.dateRows;
        var year = "" + options.year;
        if (type === "daily") {
            variables.rowNumber = monthStartWeekNumber + dateRows;
            variables.columns = 6;
        }
        else if (type === "weekly") {
            // variables.rowNumber = `${(dateRows*2)+1} - ${(dateRows*2)+2}`;
            variables.rowNumber = "";
            variables.columns = 6;
        }
        else if (type === "monthly") {
            variables.rowNumber = dateRows + 1;
            variables.columns = 2;
        }
        else if (type === "quarterly") {
            variables.rowNumber = year.charAt(dateRows);
            variables.columns = 0;
        }
        else if (type === "yearly") {
            variables.rowNumber = "";
            variables.columns = 0;
        }
        return variables;
    };
    NgxDatetimeRangePickerService.prototype.getCalendarRowItemVariables = function (options) {
        var variables = {
            currentItemDate: "",
            rowItemText: "",
            itemCount: null
        };
        var type = options.type;
        var monthStartWeekNumber = options.monthStartWeekNumber;
        var yearStartDate = options.yearStartDate;
        var year = options.year;
        var rowItem = options.rowItem;
        var dateRows = options.dateRows;
        var columns = options.columns;
        var itemCount = rowItem + dateRows * columns + dateRows;
        var currentItemDate = "";
        var rowItemText = "";
        var firstLastDayObject = {};
        if (type === "daily") {
            if (!_.isNil(monthStartWeekNumber) && !_.isNil(dateRows) && !_.isNil(year)) {
                var yearStartDateDaily = moment()
                    .year(year)
                    .startOf("year")
                    .format(DEFAULT_DATE_FROMAT);
                currentItemDate = moment(yearStartDateDaily, DEFAULT_DATE_FROMAT)
                    .add(monthStartWeekNumber + dateRows - 1, "week")
                    .startOf("week")
                    .add(rowItem, "day")
                    .format(DEFAULT_DATE_FROMAT);
                rowItemText = moment(currentItemDate, DEFAULT_DATE_FROMAT).format("D");
            }
        }
        else if (type === "weekly") {
            if (!_.isNil(yearStartDate) && !_.isNil(itemCount)) {
                currentItemDate = moment(yearStartDate, DEFAULT_DATE_FROMAT)
                    .add(itemCount, "week")
                    .endOf("week")
                    .format(DEFAULT_DATE_FROMAT);
                var weekNumber = itemCount + 1;
                rowItemText = "W" + weekNumber;
            }
        }
        else if (type === "monthly") {
            if (!_.isNil(itemCount) && !_.isNil(year)) {
                currentItemDate = moment()
                    .year(year)
                    .month(itemCount)
                    .endOf("month")
                    .format(DEFAULT_DATE_FROMAT);
                rowItemText = moment(currentItemDate, DEFAULT_DATE_FROMAT).format("MMM");
            }
        }
        else if (type === "quarterly") {
            if (!_.isNil(itemCount) && !_.isNil(year)) {
                currentItemDate = moment()
                    .year(year)
                    .quarter(itemCount + 1)
                    .endOf("quarter")
                    .format(DEFAULT_DATE_FROMAT);
                rowItemText = "Quarter " + (itemCount + 1);
            }
        }
        firstLastDayObject = this.getFirstLastDay(currentItemDate, type);
        variables.itemCount = itemCount;
        variables.currentItemDate = currentItemDate;
        variables.rowItemText = rowItemText;
        variables.firstDay = firstLastDayObject.firstDay;
        variables.lastDay = firstLastDayObject.lastDay;
        return variables;
    };
    NgxDatetimeRangePickerService.prototype.isRowIemValid = function (options) {
        var valid = false;
        var type = options.type;
        var year = options.year;
        var itemCount = options.itemCount;
        var retailCalendar = options.retailCalendar;
        var validWeekCount = this.getYearlyWeekCount(year, retailCalendar);
        if (type === "daily") {
            valid = true;
        }
        else if (type === "weekly") {
            if (itemCount < validWeekCount) {
                valid = true;
            }
        }
        else if (type === "monthly") {
            return true;
        }
        else if (type === "quarterly") {
            return true;
        }
        return valid;
    };
    NgxDatetimeRangePickerService.prototype.formatStartDate = function (config, returnFormat) {
        var startDate = config ? config.startDate : null;
        var type = config ? config.type : "";
        var formattedStartDate = null;
        if (startDate) {
            formattedStartDate = moment(startDate, DEFAULT_DATE_FROMAT).format(returnFormat);
            if (type === "weekly") {
                formattedStartDate = moment(startDate, DEFAULT_DATE_FROMAT)
                    .startOf("week")
                    .format(returnFormat);
            }
            else if (type === "monthly") {
                formattedStartDate = moment(startDate, DEFAULT_DATE_FROMAT)
                    .startOf("month")
                    .format(returnFormat);
            }
            else if (type === "quarterly") {
                formattedStartDate = moment(startDate, DEFAULT_DATE_FROMAT)
                    .startOf("quarter")
                    .format(returnFormat);
            }
            else if (type === "yearly") {
                formattedStartDate = moment(startDate, DEFAULT_DATE_FROMAT)
                    .startOf("year")
                    .format(returnFormat);
            }
        }
        return formattedStartDate;
    };
    NgxDatetimeRangePickerService.prototype.getSelectedYear = function (config, date, side) {
        return moment(date, DEFAULT_DATE_FROMAT).format("YYYY");
    };
    NgxDatetimeRangePickerService.prototype.getFirstLastDay = function (date, type) {
        var firstDay = "";
        var lastDay = "";
        if (type === "daily") {
            firstDay = lastDay = date;
        }
        else if (type === "weekly") {
            firstDay = moment(date, DEFAULT_DATE_FROMAT)
                .startOf("week")
                .format(DEFAULT_DATE_FROMAT);
            lastDay = moment(date, DEFAULT_DATE_FROMAT)
                .endOf("week")
                .format(DEFAULT_DATE_FROMAT);
        }
        else if (type === "monthly") {
            firstDay = moment(date, DEFAULT_DATE_FROMAT)
                .startOf("month")
                .format(DEFAULT_DATE_FROMAT);
            lastDay = moment(date, DEFAULT_DATE_FROMAT)
                .endOf("month")
                .format(DEFAULT_DATE_FROMAT);
        }
        else if (type === "quarterly") {
            firstDay = moment(date, DEFAULT_DATE_FROMAT)
                .startOf("quarter")
                .format(DEFAULT_DATE_FROMAT);
            lastDay = moment(date, DEFAULT_DATE_FROMAT)
                .endOf("quarter")
                .format(DEFAULT_DATE_FROMAT);
        }
        else if (type === "yearly") {
            firstDay = moment(date, DEFAULT_DATE_FROMAT)
                .startOf("year")
                .format(DEFAULT_DATE_FROMAT);
            lastDay = moment(date, DEFAULT_DATE_FROMAT)
                .endOf("year")
                .format(DEFAULT_DATE_FROMAT);
        }
        return {
            firstDay: firstDay,
            lastDay: lastDay
        };
    };
    NgxDatetimeRangePickerService.prototype.getLocalTimezone = function () {
        var tz = /\((.*)\)/.exec(new Date().toString())[1];
        if (tz === "Central Europe Standard Time") {
            tz = EU_TZ_CODE;
        }
        else {
            tz = DEFAULT_TIMEZONE_CODE;
        }
        return tz;
    };
    NgxDatetimeRangePickerService.prototype.getZoneDate = function (tz, format, date) {
        if (date) {
            date = moment(date, format)
                .startOf("day")
                .valueOf();
        }
        else {
            date = moment().valueOf();
        }
        var today = new Date(date).toLocaleString("en-US", {
            timeZone: TZ_NAMES[tz]
        });
        today = moment(today, "MM/DD/YYYY, hh:mm:ss A");
        return today;
    };
    NgxDatetimeRangePickerService.prototype.getZoneToday = function (tz, viewDateFormat) {
        var today = this.getZoneDate(tz, viewDateFormat);
        return moment(today).format(viewDateFormat + "  hh:mm A");
    };
    NgxDatetimeRangePickerService.prototype.formatToZoneDate = function (tz, format, date) {
        var formattedDate = this.getZoneDate(tz, format, date);
        return moment(formattedDate).format("" + format);
    };
    NgxDatetimeRangePickerService.prototype.convertToViewTimeItem = function (item) {
        var stringified_item = item + "";
        if (stringified_item.length === 1) {
            stringified_item = "0" + stringified_item;
        }
        return stringified_item;
    };
    NgxDatetimeRangePickerService.prototype.getWeekNumber = function (date) {
        if (date) {
            var year = moment(date, "YYYY-MM-DD").year();
            var month = moment(date, "YYYY-MM-DD").month();
            var day = Number(moment(date, "YYYY-MM-DD").format("D"));
            var yearStartms = new Date(year, 0, 1);
            var datems = new Date(year, month, day);
            return Math.ceil(((datems.getTime() - yearStartms.getTime()) / 86400000 + yearStartms.getDay() + 1) / 7);
        }
        else {
            console.warn("getWeekNumber: Invalid date");
            return this.getNotAvailableText();
        }
    };
    NgxDatetimeRangePickerService.ngInjectableDef = i0.defineInjectable({ factory: function NgxDatetimeRangePickerService_Factory() { return new NgxDatetimeRangePickerService(); }, token: NgxDatetimeRangePickerService, providedIn: "root" });
    NgxDatetimeRangePickerService = tslib_1.__decorate([
        Injectable({
            providedIn: "root"
        })
    ], NgxDatetimeRangePickerService);
    return NgxDatetimeRangePickerService;
}());
export { NgxDatetimeRangePickerService };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWRhdGV0aW1lLXJhbmdlLXBpY2tlci5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LWRhdGV0aW1lLXJhbmdlLXBpY2tlci8iLCJzb3VyY2VzIjpbImxpYi9uZ3gtZGF0ZXRpbWUtcmFuZ2UtcGlja2VyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLCtCQUErQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7O0FBSXhGLElBQU0sTUFBTSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQztBQUNqQyxJQUFNLENBQUMsR0FBRyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUM7QUFFNUIsSUFBTSxZQUFZLEdBQUcsK0JBQStCLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztBQUNsRSxJQUFNLG1CQUFtQixHQUFHLCtCQUErQixDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUM7QUFDaEYsSUFBTSxtQkFBbUIsR0FBRywrQkFBK0IsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDO0FBQ2hGLElBQU0sbUJBQW1CLEdBQUcsK0JBQStCLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQztBQUNoRixJQUFNLGtCQUFrQixHQUFHLCtCQUErQixDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUM7QUFDOUUsSUFBTSxnQkFBZ0IsR0FBRywrQkFBK0IsQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFDO0FBQzFFLElBQU0sZ0JBQWdCLEdBQUcsK0JBQStCLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQztBQUMxRSxJQUFNLGdCQUFnQixHQUFHLCtCQUErQixDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUM7QUFDMUUsSUFBTSxrQkFBa0IsR0FBRywrQkFBK0IsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDO0FBQzlFLElBQU0sZ0JBQWdCLEdBQUcsK0JBQStCLENBQUMsT0FBTyxDQUFD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LElBQUksSUFBSSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7WUFDMUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLEdBQUcsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDLEdBQUcsUUFBUSxHQUFHLFdBQVcsQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQztTQUMxRzthQUFNO1lBQ0wsT0FBTyxDQUFDLElBQUksQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1lBQzVDLE9BQU8sSUFBSSxDQUFDLG1CQUFtQixFQUFFLENBQUM7U0FDbkM7SUFDSCxDQUFDOztJQS90QlUsNkJBQTZCO1FBSHpDLFVBQVUsQ0FBQztZQUNWLFVBQVUsRUFBRSxNQUFNO1NBQ25CLENBQUM7T0FDVyw2QkFBNkIsQ0FndUJ6Qzt3Q0EzdkJEO0NBMnZCQyxBQWh1QkQsSUFndUJDO1NBaHVCWSw2QkFBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbmltcG9ydCB7IE5neERhdGV0aW1lUmFuZ2VQaWNrZXJDb25zdGFudHMgfSBmcm9tIFwiLi9uZ3gtZGF0ZXRpbWUtcmFuZ2UtcGlja2VyLmNvbnN0YW50c1wiO1xuaW1wb3J0IHsgQXJpYUxhYmVsc09wdGlvbnMsIE5neERhdGV0aW1lUmFuZ2VQaWNrZXJPcHRpb25zLCBOZ3hEYXRldGltZVJhbmdlUGlja2VyU2V0dGluZ3MgfSBmcm9tIFwiLi9pbnRlcmZhY2VzL2luZGV4XCI7XG5cbmRlY2xhcmUgdmFyIHJlcXVpcmU6IGFueTtcbmNvbnN0IG1vbWVudCA9IHJlcXVpcmUoXCJtb21lbnRcIik7XG5jb25zdCBfID0gcmVxdWlyZShcImxvZGFzaFwiKTtcblxuY29uc3QgREVGQVVMVF9UWVBFID0gTmd4RGF0ZXRpbWVSYW5nZVBpY2tlckNvbnN0YW50cy5ERUZBVUxULlRZUEU7XG5jb25zdCBERUZBVUxUX0lOUFVUX0NMQVNTID0gTmd4RGF0ZXRpbWVSYW5nZVBpY2tlckNvbnN0YW50cy5ERUZBVUxULklOUFVUX0NMQVNTO1xuY29uc3QgREVGQVVMVF9EQVRFX0ZST01BVCA9IE5neERhdGV0aW1lUmFuZ2VQaWNrZXJDb25zdGFudHMuREVGQVVMVC5EQVRFX0ZST01BVDtcbmNvbnN0IERFRkFVTFRfVElNRV9GT1JNQVQgPSBOZ3hEYXRldGltZVJhbmdlUGlja2VyQ29uc3RhbnRzLkRFRkFVTFQuVElNRV9GT1JNQVQ7XG5jb25zdCBERUZBVUxUX1NUQVJUX0RBVEUgPSBOZ3hEYXRldGltZVJhbmdlUGlja2VyQ29uc3RhbnRzLkRFRkFVTFQuU1RBUlRfREFURTtcbmNvbnN0IERFRkFVTFRfRU5EX0RBVEUgPSBOZ3hEYXRldGltZVJhbmdlUGlja2VyQ29uc3RhbnRzLkRFRkFVTFQuRU5EX0RBVEU7XG5jb25zdCBERUZBVUxUX01JTl9EQVRFID0gTmd4RGF0ZXRpbWVSYW5nZVBpY2tlckNvbnN0YW50cy5ERUZBVUxULk1JTl9EQVRFO1xuY29uc3QgREVGQVVMVF9NQVhfREFURSA9IE5neERhdGV0aW1lUmFuZ2VQaWNrZXJDb25zdGFudHMuREVGQVVMVC5NQVhfREFURTtcbmNvbnN0IERFRkFVTFRfU1RBUlRfVElNRSA9IE5neERhdGV0aW1lUmFuZ2VQaWNrZXJDb25zdGFudHMuREVGQVVMVC5TVEFSVF9USU1FO1xuY29uc3QgREVGQVVMVF9FTkRfVElNRSA9IE5neERhdGV0aW1lUmFuZ2VQaWNrZXJDb25zdGFudHMuREVGQVVMVC5FTkRfVElNRTtcbmNvbnN0IERFRkFVTFRfTU9ERUxfS0VZUyA9IE5neERhdGV0aW1lUmFuZ2VQaWNrZXJDb25zdGFudHMuREVGQVVMVC5NT0RFTF9LRVlTO1xuY29uc3QgTU9OVEhTX0FWQUlMQUJMRSA9IE5neERhdGV0aW1lUmFuZ2VQaWNrZXJDb25zdGFudHMuQ09OU1RBTlQuTU9OVEhTX0FWQUlMQUJMRTtcbmNvbnN0IERFRkFVTFRfVElNRVpPTkVfQ09ERSA9IE5neERhdGV0aW1lUmFuZ2VQaWNrZXJDb25zdGFudHMuREVGQVVMVC5UWl9DT0RFO1xuY29uc3QgRVVfVFpfQ09ERSA9IE5neERhdGV0aW1lUmFuZ2VQaWNrZXJDb25zdGFudHMuQ09OU1RBTlQuRVVfVFpfQ09ERTtcbmNvbnN0IFRaX05BTUVTID0gTmd4RGF0ZXRpbWVSYW5nZVBpY2tlckNvbnN0YW50cy5DT05TVEFOVC5UWl9OQU1FUztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiBcInJvb3RcIlxufSlcbmV4cG9ydCBjbGFzcyBOZ3hEYXRldGltZVJhbmdlUGlja2VyU2VydmljZSB7XG4gIGdldE5vdEF2YWlsYWJsZVRleHQoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gXCJOL0FcIjtcbiAgfVxuXG4gIGdldERlZmF1bHRBcmlhTGFiZWxPcHRpb25zKCk6IEFyaWFMYWJlbHNPcHRpb25zIHtcbiAgICByZXR1cm4ge1xuICAgICAgaW5wdXRGaWVsZDogXCJEYXRlIFJhbmdlIElucHV0IEZpZWxkXCIgYXMgc3RyaW5nXG4gICAgfTtcbiAgfVxuXG4gIGdldERlZmF1bHRPcHRpb25zKCk6IE5neERhdGV0aW1lUmFuZ2VQaWNrZXJPcHRpb25zIHtcbiAgICByZXR1cm4ge1xuICAgICAgZGF0ZUFycmF5OiBbXSBhcyBzdHJpbmdbXSxcbiAgICAgIHN0YXJ0RGF0ZTogREVGQVVMVF9TVEFSVF9EQVRFIGFzIHN0cmluZyxcbiAgICAgIGVuZERhdGU6IERFRkFVTFRfRU5EX0RBVEUgYXMgc3RyaW5nLFxuICAgICAgbWluRGF0ZTogREVGQVVMVF9NSU5fREFURSBhcyBzdHJpbmcsXG4gICAgICBtYXhEYXRlOiBERUZBVUxUX01BWF9EQVRFIGFzIHN0cmluZyxcbiAgICAgIHN0YXJ0VGltZTogREVGQVVMVF9TVEFSVF9USU1FIGFzIHN0cmluZyxcbiAgICAgIGVuZFRpbWU6IERFRkFVTFRfRU5EX1RJTUUgYXMgc3RyaW5nXG4gICAgfTtcbiAgfVxuXG4gIGdldERlZmF1bHRTZXR0aW5ncygpOiBOZ3hEYXRldGltZVJhbmdlUGlja2VyU2V0dGluZ3Mge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBERUZBVUxUX1RZUEUgYXMgc3RyaW5nLFxuICAgICAgbW9kZWxLZXlzOiBERUZBVUxUX01PREVMX0tFWVMgYXMgc3RyaW5nW10sXG4gICAgICBzZWxlY3RlZE1vZGVsOiB1bmRlZmluZWQgYXMgc3RyaW5nLFxuICAgICAgc2hvd1RpbWV6b25lU2VsZWN0OiBmYWxzZSBhcyBib29sZWFuLFxuICAgICAgdXNlTG9jYWxUaW1lem9uZTogZmFsc2UgYXMgYm9vbGVhbixcbiAgICAgIHRpbWVQaWNrZXI6IGZhbHNlIGFzIGJvb2xlYW4sXG4gICAgICBpbnB1dENsYXNzOiBERUZBVUxUX0lOUFVUX0NMQVNTIGFzIHN0cmluZyxcbiAgICAgIGlucHV0RGF0ZUZvcm1hdDogbnVsbCBhcyBzdHJpbmcsXG4gICAgICB2aWV3RGF0ZUZvcm1hdDogREVGQVVMVF9EQVRFX0ZST01BVCBhcyBzdHJpbmcsXG4gICAgICBvdXRwdXREYXRlRm9ybWF0OiBERUZBVUxUX0RBVEVfRlJPTUFUIGFzIHN0cmluZyxcbiAgICAgIHNpbmdsZURhdGVQaWNrZXI6IGZhbHNlIGFzIGJvb2xlYW4sXG4gICAgICBjb21wb25lbnREaXNhYmxlZDogZmFsc2UgYXMgYm9vbGVhbixcbiAgICAgIHBsYWNlaG9sZGVyOiBcIlNlbGVjdCBEYXRlXCIgYXMgc3RyaW5nLFxuICAgICAgc2hvd1Jvd051bWJlcjogdHJ1ZSBhcyBib29sZWFuLFxuICAgICAgYXZhaWxhYmxlUmFuZ2VzOiB7fSBhcyBPYmplY3QsXG4gICAgICBzaG93UmFuZ2VzOiB0cnVlIGFzIGJvb2xlYW4sXG4gICAgICBkaXNhYmxlV2Vla2VuZHM6IGZhbHNlIGFzIGJvb2xlYW4sXG4gICAgICBkaXNhYmxlV2Vla2RheXM6IGZhbHNlIGFzIGJvb2xlYW4sXG4gICAgICByZXRhaWxDYWxlbmRhcjogZmFsc2UgYXMgYm9vbGVhbixcbiAgICAgIGRpc3BsYXlCZWdpbkRhdGU6IGZhbHNlIGFzIGJvb2xlYW4sXG4gICAgICBkaXNwbGF5RW5kRGF0ZTogZmFsc2UgYXMgYm9vbGVhbixcbiAgICAgIGFyaWFMYWJlbHM6IHRoaXMuZ2V0RGVmYXVsdEFyaWFMYWJlbE9wdGlvbnMoKSBhcyBBcmlhTGFiZWxzT3B0aW9uc1xuICAgIH07XG4gIH1cblxuICBmb3JtYXREYXRlVG9EZWZhdWx0Rm9ybWF0KGRhdGUsIGZvcm1hdCA9IERFRkFVTFRfREFURV9GUk9NQVQpOiBzdHJpbmcge1xuICAgIGxldCBmcm9tYXR0ZWREYXRlID0gbnVsbDtcbiAgICBpZiAoZGF0ZSkge1xuICAgICAgaWYgKCFpc05hTihOdW1iZXIoZGF0ZSkpKSB7XG4gICAgICAgIGZyb21hdHRlZERhdGUgPSBtb21lbnQoZGF0ZSkuZm9ybWF0KERFRkFVTFRfREFURV9GUk9NQVQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCFmb3JtYXQpIHtcbiAgICAgICAgICBmb3JtYXQgPSBtb21lbnQoZGF0ZSkuX2Y7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKGZvcm1hdCAhPT0gbW9tZW50KGRhdGUpLl9mKSB7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oXCJFUlJfTkdYX0RBVEVUSU1FX1JBTkdFX1BJQ0tFUjogaW5wdXREYXRlRm9ybWF0ICE9PSBkYXRlRm9ybWF0XCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIWZvcm1hdCkge1xuICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgIFwiRVJSX05HWF9EQVRFVElNRV9SQU5HRV9QSUNLRVI6IFRoZSBwcm92aWRlZCBkYXRlIGlzIGluIHVua25vd24gZm9ybWF0LiBQYXNzIHRoZSBmb3JtYXQgb3IgcGFzcyB0aGUgZGF0ZSBpbiBrbm93biBmb3JtYXRcIlxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgZnJvbWF0dGVkRGF0ZSA9IG1vbWVudChkYXRlLCBmb3JtYXQpLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZnJvbWF0dGVkRGF0ZTtcbiAgfVxuXG4gIGZvcm1hdFRpbWVUb0RlZmF1bHRGb3JtYXQodGltZSkge1xuICAgIGxldCBmb3JtYXR0ZWRUaW1lID0gbnVsbDtcbiAgICBpZiAodGltZSkge1xuICAgICAgaWYgKHRpbWUuaW5kZXhPZihcIjpcIikgPiAtMSkge1xuICAgICAgICBpZiAodGltZS5pbmRleE9mKFwiQU1cIikgPiAtMSB8fCB0aW1lLmluZGV4T2YoXCJQTVwiKSA+IC0xKSB7XG4gICAgICAgICAgZm9ybWF0dGVkVGltZSA9IG1vbWVudCh0aW1lLCBcImg6bW0gQVwiKS5mb3JtYXQoREVGQVVMVF9USU1FX0ZPUk1BVCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZm9ybWF0dGVkVGltZSA9IHRpbWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICBcIkVSUl9OR1hfREFURVRJTUVfUkFOR0VfUElDS0VSOiBUaGUgcHJvdmlkZWQgdGltZSBpcyBub3QgaW4gY29ycmVjdCBmb3JtYXQuIEZvcm1hdDogSEg6bW0gb3IgaGg6bW0gQVwiXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmb3JtYXR0ZWRUaW1lO1xuICB9XG5cbiAgZ2V0RnJlcXVlbmN5Q29sdW1uSGVhZGVyKHR5cGUpIHtcbiAgICByZXR1cm4gKCgpID0+IHtcbiAgICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgICBjYXNlIFwiZGFpbHlcIjpcbiAgICAgICAgICByZXR1cm4gXCJXI1wiO1xuICAgICAgICBjYXNlIFwid2Vla2x5XCI6XG4gICAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgICAgIGNhc2UgXCJtb250aGx5XCI6XG4gICAgICAgICAgcmV0dXJuIFwiUSNcIjtcbiAgICAgICAgY2FzZSBcInF1YXJ0ZXJseVwiOlxuICAgICAgICAgIHJldHVybiBcIlllYXJcIjtcbiAgICAgICAgY2FzZSBcInllYXJseVwiOlxuICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgfVxuICAgIH0pKCk7XG4gIH1cblxuICBnZXRDYWxlbmRhclJvd051bWJlclRleHQodHlwZSwgbnVtYmVyKSB7XG4gICAgcmV0dXJuICgoKSA9PiB7XG4gICAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgICAgY2FzZSBcImRhaWx5XCI6XG4gICAgICAgICAgcmV0dXJuIGBXJHtudW1iZXJ9YDtcbiAgICAgICAgY2FzZSBcIndlZWtseVwiOlxuICAgICAgICAgIHJldHVybiBcIlwiO1xuICAgICAgICBjYXNlIFwibW9udGhseVwiOlxuICAgICAgICAgIHJldHVybiBgUSR7bnVtYmVyfWA7XG4gICAgICAgIGNhc2UgXCJxdWFydGVybHlcIjpcbiAgICAgICAgICByZXR1cm4gYCR7bnVtYmVyfWA7XG4gICAgICAgIGNhc2UgXCJ5ZWFybHlcIjpcbiAgICAgICAgICByZXR1cm4gXCJcIjtcbiAgICAgIH1cbiAgICB9KSgpO1xuICB9XG5cbiAgY3JlYXRlRGVmYXVsdFJhbmdlcyhjb25maWcpOiBPYmplY3Qge1xuICAgIGNvbnN0IHJhbmdlcyA9IHt9O1xuICAgIGNvbnN0IHR5cGUgPSBjb25maWcudHlwZTtcbiAgICBjb25zdCBtYXhEYXRlID0gXy5jbG9uZURlZXAoY29uZmlnLm1heERhdGUpO1xuICAgIGNvbnN0IGZvcm1hdHRlZE1heERhdGUgPSB0aGlzLmZvcm1hdERhdGVUb0RlZmF1bHRGb3JtYXQobWF4RGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVCk7XG5cbiAgICBpZiAodHlwZSA9PT0gXCJkYWlseVwiKSB7XG4gICAgICByYW5nZXNbXCJMYXN0IDcgRGF5c1wiXSA9IHtcbiAgICAgICAgc3RhcnREYXRlOiBtb21lbnQoZm9ybWF0dGVkTWF4RGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVClcbiAgICAgICAgICAuc3VidHJhY3QoNiwgXCJkYXlzXCIpXG4gICAgICAgICAgLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKSxcbiAgICAgICAgZW5kRGF0ZTogZm9ybWF0dGVkTWF4RGF0ZVxuICAgICAgfTtcbiAgICAgIHJhbmdlc1tcIkxhc3QgMzAgRGF5c1wiXSA9IHtcbiAgICAgICAgc3RhcnREYXRlOiBtb21lbnQoZm9ybWF0dGVkTWF4RGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVClcbiAgICAgICAgICAuc3VidHJhY3QoMjksIFwiZGF5c1wiKVxuICAgICAgICAgIC5mb3JtYXQoREVGQVVMVF9EQVRFX0ZST01BVCksXG4gICAgICAgIGVuZERhdGU6IGZvcm1hdHRlZE1heERhdGVcbiAgICAgIH07XG4gICAgICByYW5nZXNbXCJMYXN0IDkwIERheXNcIl0gPSB7XG4gICAgICAgIHN0YXJ0RGF0ZTogbW9tZW50KGZvcm1hdHRlZE1heERhdGUsIERFRkFVTFRfREFURV9GUk9NQVQpXG4gICAgICAgICAgLnN1YnRyYWN0KDg5LCBcImRheXNcIilcbiAgICAgICAgICAuZm9ybWF0KERFRkFVTFRfREFURV9GUk9NQVQpLFxuICAgICAgICBlbmREYXRlOiBmb3JtYXR0ZWRNYXhEYXRlXG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJ3ZWVrbHlcIikge1xuICAgICAgcmFuZ2VzW1wiTGFzdCA0IFdlZWtzXCJdID0ge1xuICAgICAgICBzdGFydERhdGU6IG1vbWVudChmb3JtYXR0ZWRNYXhEYXRlLCBERUZBVUxUX0RBVEVfRlJPTUFUKVxuICAgICAgICAgIC5zdWJ0cmFjdCgzLCBcIndlZWtzXCIpXG4gICAgICAgICAgLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKSxcbiAgICAgICAgZW5kRGF0ZTogZm9ybWF0dGVkTWF4RGF0ZVxuICAgICAgfTtcbiAgICAgIHJhbmdlc1tcIkxhc3QgMTMgV2Vla3NcIl0gPSB7XG4gICAgICAgIHN0YXJ0RGF0ZTogbW9tZW50KGZvcm1hdHRlZE1heERhdGUsIERFRkFVTFRfREFURV9GUk9NQVQpXG4gICAgICAgICAgLnN1YnRyYWN0KDEyLCBcIndlZWtzXCIpXG4gICAgICAgICAgLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKSxcbiAgICAgICAgZW5kRGF0ZTogZm9ybWF0dGVkTWF4RGF0ZVxuICAgICAgfTtcbiAgICAgIHJhbmdlc1tcIkxhc3QgMjYgV2Vla3NcIl0gPSB7XG4gICAgICAgIHN0YXJ0RGF0ZTogbW9tZW50KGZvcm1hdHRlZE1heERhdGUsIERFRkFVTFRfREFURV9GUk9NQVQpXG4gICAgICAgICAgLnN1YnRyYWN0KDI1LCBcIndlZWtzXCIpXG4gICAgICAgICAgLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKSxcbiAgICAgICAgZW5kRGF0ZTogZm9ybWF0dGVkTWF4RGF0ZVxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwibW9udGhseVwiKSB7XG4gICAgICAvLyBpZihyZXRhaWxDYWxlbmRhcikgPyBzdWJ0cmFjdCgzLCAnbW9udGhzJykuLi4uc28gb24gZm9yICdMYXN0IDMgTW9udGhzJy4uLi5zbyBvblxuICAgICAgcmFuZ2VzW1wiTGFzdCAzIE1vbnRoc1wiXSA9IHtcbiAgICAgICAgc3RhcnREYXRlOiBtb21lbnQoZm9ybWF0dGVkTWF4RGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVClcbiAgICAgICAgICAuc3VidHJhY3QoMiwgXCJtb250aHNcIilcbiAgICAgICAgICAuZm9ybWF0KERFRkFVTFRfREFURV9GUk9NQVQpLFxuICAgICAgICBlbmREYXRlOiBmb3JtYXR0ZWRNYXhEYXRlXG4gICAgICB9O1xuICAgICAgcmFuZ2VzW1wiTGFzdCA2IE1vbnRoc1wiXSA9IHtcbiAgICAgICAgc3RhcnREYXRlOiBtb21lbnQoZm9ybWF0dGVkTWF4RGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVClcbiAgICAgICAgICAuc3VidHJhY3QoNSwgXCJtb250aHNcIilcbiAgICAgICAgICAuZm9ybWF0KERFRkFVTFRfREFURV9GUk9NQVQpLFxuICAgICAgICBlbmREYXRlOiBmb3JtYXR0ZWRNYXhEYXRlXG4gICAgICB9O1xuICAgICAgcmFuZ2VzW1wiTGFzdCA5IE1vbnRoc1wiXSA9IHtcbiAgICAgICAgc3RhcnREYXRlOiBtb21lbnQoZm9ybWF0dGVkTWF4RGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVClcbiAgICAgICAgICAuc3VidHJhY3QoOCwgXCJtb250aHNcIilcbiAgICAgICAgICAuZm9ybWF0KERFRkFVTFRfREFURV9GUk9NQVQpLFxuICAgICAgICBlbmREYXRlOiBmb3JtYXR0ZWRNYXhEYXRlXG4gICAgICB9O1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJxdWFydGVybHlcIikge1xuICAgICAgLy8gaWYocmV0YWlsQ2FsZW5kYXIpID8gc3VidHJhY3QoMSwgJ3F1YXJ0ZXJzJykuLi4uc28gb24gZm9yICdMYXN0IDIgUXVhcnRlcnMnLi4uLnNvIG9uXG4gICAgICByYW5nZXNbXCJMYXN0IDIgUXVhcnRlcnNcIl0gPSB7XG4gICAgICAgIHN0YXJ0RGF0ZTogbW9tZW50KGZvcm1hdHRlZE1heERhdGUsIERFRkFVTFRfREFURV9GUk9NQVQpXG4gICAgICAgICAgLnN1YnRyYWN0KDEsIFwicXVhcnRlcnNcIilcbiAgICAgICAgICAuZm9ybWF0KERFRkFVTFRfREFURV9GUk9NQVQpLFxuICAgICAgICBlbmREYXRlOiBmb3JtYXR0ZWRNYXhEYXRlXG4gICAgICB9O1xuICAgICAgcmFuZ2VzW1wiTGFzdCA0IFF1YXJ0ZXJzXCJdID0ge1xuICAgICAgICBzdGFydERhdGU6IG1vbWVudChmb3JtYXR0ZWRNYXhEYXRlLCBERUZBVUxUX0RBVEVfRlJPTUFUKVxuICAgICAgICAgIC5zdWJ0cmFjdCgzLCBcInF1YXJ0ZXJzXCIpXG4gICAgICAgICAgLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKSxcbiAgICAgICAgZW5kRGF0ZTogZm9ybWF0dGVkTWF4RGF0ZVxuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwieWVhcmx5XCIpIHtcbiAgICAgIHJhbmdlc1tcIkxhc3QgWWVhclwiXSA9IHtcbiAgICAgICAgc3RhcnREYXRlOiBtb21lbnQoZm9ybWF0dGVkTWF4RGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVClcbiAgICAgICAgICAuc3VidHJhY3QoMSwgXCJ5ZWFyXCIpXG4gICAgICAgICAgLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKSxcbiAgICAgICAgZW5kRGF0ZTogZm9ybWF0dGVkTWF4RGF0ZVxuICAgICAgfTtcbiAgICB9XG4gICAgcmFuZ2VzW1wiQ3VzdG9tIFJhbmdlXCJdID0geyBzdGFydERhdGU6IG51bGwsIGVuZERhdGU6IG51bGwgfTtcbiAgICByZXR1cm4gcmFuZ2VzO1xuICB9XG5cbiAgZ2V0U2FuaXRpemVkRGF0ZUFycmF5KGNvbmZpZykge1xuICAgIGNvbnN0IHNhbml0aXplZERhdGVBcnJheSA9IFtdO1xuICAgIGNvbnN0IHR5cGUgPSBjb25maWcudHlwZTtcbiAgICBjb25zdCBkYXRlQXJyYXkgPSBjb25maWcuZGF0ZUFycmF5O1xuICAgIGNvbnN0IGlucHV0RGF0ZUZvcm1hdCA9IGNvbmZpZy5pbnB1dERhdGVGb3JtYXQ7XG5cbiAgICAvLyBkYXRlQXJyYXkgY2FuIGhhdmUgbnVsbHNcbiAgICBfLmZvckVhY2goZGF0ZUFycmF5LCAoZGF0ZSkgPT4ge1xuICAgICAgaWYgKGRhdGUpIHtcbiAgICAgICAgbGV0IGZvcm1hdCA9IG51bGw7XG4gICAgICAgIGlmIChpc05hTihOdW1iZXIoZGF0ZSkpKSB7XG4gICAgICAgICAgaWYgKGlucHV0RGF0ZUZvcm1hdCkge1xuICAgICAgICAgICAgZm9ybWF0ID0gaW5wdXREYXRlRm9ybWF0O1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3JtYXQgPSBtb21lbnQoZGF0ZSkuX2Y7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGlucHV0RGF0ZUZvcm1hdCAhPT0gbW9tZW50KGRhdGUpLl9mKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgXCJFUlJfTkdYX0RBVEVUSU1FX1JBTkdFX1BJQ0tFUjogaW5wdXREYXRlRm9ybWF0ICE9PSBkYXRlRm9ybWF0IGluIGRhdGVBcnJheS4gQ29udmVydGVkIGRhdGVzIG1pZ2h0IG5vdCBiZSBhcyBleHBlY3RlZFwiXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB2YWx1ZSA9IGZvcm1hdCA/IG1vbWVudChkYXRlLCBmb3JtYXQpLmZvcm1hdChmb3JtYXQpIDogbW9tZW50KGRhdGUpLnZhbHVlT2YoKTtcbiAgICAgICAgaWYgKHR5cGUgPT09IFwid2Vla2x5XCIpIHtcbiAgICAgICAgICB2YWx1ZSA9IGZvcm1hdFxuICAgICAgICAgICAgPyBtb21lbnQoZGF0ZSwgZm9ybWF0KVxuICAgICAgICAgICAgICAgIC5lbmRPZihcIndlZWtcIilcbiAgICAgICAgICAgICAgICAuZm9ybWF0KGZvcm1hdClcbiAgICAgICAgICAgIDogbW9tZW50KGRhdGUpXG4gICAgICAgICAgICAgICAgLmVuZE9mKFwid2Vla1wiKVxuICAgICAgICAgICAgICAgIC52YWx1ZU9mKCk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJtb250aGx5XCIpIHtcbiAgICAgICAgICB2YWx1ZSA9IGZvcm1hdFxuICAgICAgICAgICAgPyBtb21lbnQoZGF0ZSwgZm9ybWF0KVxuICAgICAgICAgICAgICAgIC5lbmRPZihcIm1vbnRoXCIpXG4gICAgICAgICAgICAgICAgLmZvcm1hdChmb3JtYXQpXG4gICAgICAgICAgICA6IG1vbWVudChkYXRlKVxuICAgICAgICAgICAgICAgIC5lbmRPZihcIm1vbnRoXCIpXG4gICAgICAgICAgICAgICAgLnZhbHVlT2YoKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSBcInF1YXJ0ZXJseVwiKSB7XG4gICAgICAgICAgdmFsdWUgPSBmb3JtYXRcbiAgICAgICAgICAgID8gbW9tZW50KGRhdGUsIGZvcm1hdClcbiAgICAgICAgICAgICAgICAuZW5kT2YoXCJxdWFydGVyXCIpXG4gICAgICAgICAgICAgICAgLmZvcm1hdChmb3JtYXQpXG4gICAgICAgICAgICA6IG1vbWVudChkYXRlKVxuICAgICAgICAgICAgICAgIC5lbmRPZihcInF1YXJ0ZXJcIilcbiAgICAgICAgICAgICAgICAudmFsdWVPZigpO1xuICAgICAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwieWVhcmx5XCIpIHtcbiAgICAgICAgICB2YWx1ZSA9IGZvcm1hdFxuICAgICAgICAgICAgPyBtb21lbnQoZGF0ZSwgZm9ybWF0KVxuICAgICAgICAgICAgICAgIC5lbmRPZihcInllYXJcIilcbiAgICAgICAgICAgICAgICAuZm9ybWF0KGZvcm1hdClcbiAgICAgICAgICAgIDogbW9tZW50KGRhdGUpXG4gICAgICAgICAgICAgICAgLmVuZE9mKFwieWVhclwiKVxuICAgICAgICAgICAgICAgIC52YWx1ZU9mKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZhbHVlKSB7XG4gICAgICAgICAgc2FuaXRpemVkRGF0ZUFycmF5LnB1c2godmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUud2FybihcbiAgICAgICAgICAgIGBFUlJfTkdYX0RBVEVUSU1FX1JBTkdFX1BJQ0tFUjogZGF0ZUFycmF5IHZhbHVlcyBhcmUgaW4gdW5rbm93biBmb3JtYXQuIFBhc3MgdGhlIGZvcm1hdCBvciBwYXNzIHRoZSBkYXRlcyBpbiBrbm93biBmb3JtYXRgXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIF8udW5pcUJ5KHNhbml0aXplZERhdGVBcnJheSk7XG4gIH1cblxuICBnZXROdW1iZXJPZldlZWtzKGRhdGUpOiBudW1iZXIge1xuICAgIGxldCBudW1iZXJPZldlZWtzID0gbnVsbDtcbiAgICBpZiAoZGF0ZSkge1xuICAgICAgY29uc3QgbW9udGhTdGFydDogbnVtYmVyID0gbW9tZW50KGRhdGUsIERFRkFVTFRfREFURV9GUk9NQVQpXG4gICAgICAgIC5zdGFydE9mKFwibW9udGhcIilcbiAgICAgICAgLmRheSgpO1xuICAgICAgY29uc3QgbW9udGhFbmQ6IG51bWJlciA9IE51bWJlcihcbiAgICAgICAgbW9tZW50KGRhdGUsIERFRkFVTFRfREFURV9GUk9NQVQpXG4gICAgICAgICAgLmVuZE9mKFwibW9udGhcIilcbiAgICAgICAgICAuZm9ybWF0KFwiRFwiKVxuICAgICAgKTtcbiAgICAgIG51bWJlck9mV2Vla3MgPSBNYXRoLmNlaWwoKG1vbnRoU3RhcnQgKyBtb250aEVuZCkgLyA3KTtcbiAgICB9XG4gICAgcmV0dXJuIG51bWJlck9mV2Vla3M7XG4gIH1cblxuICBnZXRZZWFybHlXZWVrQ291bnQoeWVhciwgcmV0YWlsQ2FsZW5kYXI/KSB7XG4gICAgbGV0IHdlZWtDb3VudDogbnVtYmVyID0gbnVsbDtcbiAgICBpZiAoeWVhcikge1xuICAgICAgY29uc3QgeWVhclN0YXJ0RGF0ZSA9IG1vbWVudCh5ZWFyLCBcIllZWVlcIilcbiAgICAgICAgLnN0YXJ0T2YoXCJ5ZWFyXCIpXG4gICAgICAgIC5mb3JtYXQoREVGQVVMVF9EQVRFX0ZST01BVCk7XG4gICAgICBjb25zdCB5ZWFyRW5kRGF0ZSA9IG1vbWVudCh5ZWFyLCBcIllZWVlcIilcbiAgICAgICAgLmVuZE9mKFwieWVhclwiKVxuICAgICAgICAuZm9ybWF0KERFRkFVTFRfREFURV9GUk9NQVQpO1xuICAgICAgY29uc3QgeWVhckVuZFdlZWtFbmREYXRlID0gbW9tZW50KHllYXJFbmREYXRlLCBERUZBVUxUX0RBVEVfRlJPTUFUKVxuICAgICAgICAuc3RhcnRPZihcIndlZWtcIilcbiAgICAgICAgLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKTtcblxuICAgICAgY29uc3QgeWVhclN0YXJ0V2Vla0VuZERhdGUgPSBtb21lbnQoeWVhclN0YXJ0RGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVClcbiAgICAgICAgLmVuZE9mKFwid2Vla1wiKVxuICAgICAgICAuZm9ybWF0KERFRkFVTFRfREFURV9GUk9NQVQpO1xuXG4gICAgICBjb25zdCB5ZWFyU2FydFdlZWtOdW1iZXIgPSB0aGlzLmdldFdlZWtOdW1iZXIoeWVhclN0YXJ0V2Vla0VuZERhdGUpO1xuICAgICAgY29uc3QgeWVhckVuZFdlZWtOdW1iZXIgPSB0aGlzLmdldFdlZWtOdW1iZXIoeWVhckVuZFdlZWtFbmREYXRlKTtcbiAgICAgIHdlZWtDb3VudCA9IHllYXJFbmRXZWVrTnVtYmVyIC0geWVhclNhcnRXZWVrTnVtYmVyICsgMTtcbiAgICB9XG4gICAgcmV0dXJuIHdlZWtDb3VudDtcbiAgfVxuXG4gIGdldE1vbnRoc0F2YWlsYWJsZShtaW5EYXRlLCBtYXhEYXRlLCBzZWxlY3RlZFllYXIpIHtcbiAgICBjb25zdCBtb250aHMgPSBbXTtcbiAgICBpZiAobWluRGF0ZSAmJiBtYXhEYXRlICYmIHNlbGVjdGVkWWVhcikge1xuICAgICAgbGV0IG1pbkRhdGVtcyA9IG1vbWVudChtaW5EYXRlLCBERUZBVUxUX0RBVEVfRlJPTUFUKS52YWx1ZU9mKCk7XG4gICAgICBsZXQgbWF4RGF0ZW1zID0gbW9tZW50KG1heERhdGUsIERFRkFVTFRfREFURV9GUk9NQVQpLnZhbHVlT2YoKTtcbiAgICAgIGNvbnN0IHllYXJTdGFydG1zID0gbW9tZW50KClcbiAgICAgICAgLnllYXIoc2VsZWN0ZWRZZWFyKVxuICAgICAgICAuc3RhcnRPZihcInllYXJcIilcbiAgICAgICAgLnZhbHVlT2YoKTtcbiAgICAgIGNvbnN0IHllYXJFbmRtcyA9IG1vbWVudCgpXG4gICAgICAgIC55ZWFyKHNlbGVjdGVkWWVhcilcbiAgICAgICAgLmVuZE9mKFwieWVhclwiKVxuICAgICAgICAudmFsdWVPZigpO1xuXG4gICAgICBpZiAobWluRGF0ZW1zIDwgeWVhclN0YXJ0bXMpIHtcbiAgICAgICAgbWluRGF0ZW1zID0geWVhclN0YXJ0bXM7XG4gICAgICB9XG4gICAgICBpZiAobWF4RGF0ZW1zID4geWVhckVuZG1zKSB7XG4gICAgICAgIG1heERhdGVtcyA9IHllYXJFbmRtcztcbiAgICAgIH1cblxuICAgICAgbGV0IG1pbkRhdGVNb250aE51bWJlciA9IG1vbWVudChtaW5EYXRlbXMpLm1vbnRoKCk7XG4gICAgICBjb25zdCBkaWZmOiBudW1iZXIgPSBtb21lbnQobWF4RGF0ZW1zKS5kaWZmKG1vbWVudChtaW5EYXRlbXMpLCBcIm1vbnRoc1wiKTtcbiAgICAgIGNvbnN0IG1heE1vbnRocyA9IGRpZmYgPCBNT05USFNfQVZBSUxBQkxFLmxlbmd0aCA/IGRpZmYgOiBNT05USFNfQVZBSUxBQkxFLmxlbmd0aDtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbWF4TW9udGhzOyBpKyspIHtcbiAgICAgICAgaWYgKG1pbkRhdGVNb250aE51bWJlciA+PSBNT05USFNfQVZBSUxBQkxFLmxlbmd0aCkge1xuICAgICAgICAgIG1vbnRocy5wdXNoKE1PTlRIU19BVkFJTEFCTEVbbWluRGF0ZU1vbnRoTnVtYmVyIC0gTU9OVEhTX0FWQUlMQUJMRS5sZW5ndGhdKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBtb250aHMucHVzaChNT05USFNfQVZBSUxBQkxFW21pbkRhdGVNb250aE51bWJlcl0pO1xuICAgICAgICB9XG4gICAgICAgIG1pbkRhdGVNb250aE51bWJlcisrO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbW9udGhzO1xuICB9XG5cbiAgZ2V0WWVhcnNBdmFpbGFibGUoY29uZmlnKSB7XG4gICAgY29uc3QgbWluRGF0ZSA9IGNvbmZpZyA/IGNvbmZpZy5taW5EYXRlIDogXCJcIjtcbiAgICBjb25zdCBtYXhEYXRlID0gY29uZmlnID8gY29uZmlnLm1heERhdGUgOiBcIlwiO1xuICAgIGNvbnN0IHllYXJzID0gW107XG4gICAgaWYgKG1pbkRhdGUgJiYgbWF4RGF0ZSkge1xuICAgICAgY29uc3QgbWluWWVhciA9IE51bWJlcih0aGlzLmdldFNlbGVjdGVkWWVhcihjb25maWcsIG1pbkRhdGUsIFwibGVmdFwiKSk7XG4gICAgICBjb25zdCBtYXhZZWFyID0gTnVtYmVyKHRoaXMuZ2V0U2VsZWN0ZWRZZWFyKGNvbmZpZywgbWF4RGF0ZSwgXCJyaWdodFwiKSk7XG4gICAgICBjb25zdCBkaWZmID0gbWF4WWVhciAtIG1pblllYXI7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IGRpZmY7IGkrKykge1xuICAgICAgICB5ZWFycy5wdXNoKGAke21pblllYXIgKyBpfWApO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4geWVhcnMucmV2ZXJzZSgpO1xuICB9XG5cbiAgaXNEYXRlQXZhaWxhYmxlKGRhdGUsIG1pbkRhdGUsIG1heERhdGUsIHN0YXJ0RGF0ZSwgZW5kRGF0ZSwgbW9udGhTdGFydERhdGUsIG1vbnRoRW5kRGF0ZSwgY29uZmlnKTogYm9vbGVhbiB7XG4gICAgbGV0IGF2YWlsYWJsZSA9IGZhbHNlO1xuICAgIGNvbnN0IHR5cGUgPSBjb25maWcudHlwZTtcbiAgICBjb25zdCBkYXRlQXJyYXkgPSBjb25maWcuZGF0ZUFycmF5ID8gY29uZmlnLmRhdGVBcnJheSA6IFtdO1xuICAgIGNvbnN0IGlucHV0RGF0ZUZvcm1hdCA9IGNvbmZpZy5pbnB1dERhdGVGb3JtYXQ7XG4gICAgY29uc3QgZGlzYWJsZVdlZWtlbmRzID0gY29uZmlnLmRpc2FibGVXZWVrZW5kcztcbiAgICBjb25zdCBkaXNhYmxlV2Vla2RheXMgPSBjb25maWcuZGlzYWJsZVdlZWtkYXlzO1xuICAgIGlmICh0eXBlID09PSBcImRhaWx5XCIpIHtcbiAgICAgIG1pbkRhdGUgPSBtaW5EYXRlID4gbW9udGhTdGFydERhdGUgPyBtaW5EYXRlIDogbW9udGhTdGFydERhdGU7XG4gICAgICBtYXhEYXRlID0gbWF4RGF0ZSA8IG1vbnRoRW5kRGF0ZSA/IG1heERhdGUgOiBtb250aEVuZERhdGU7XG4gICAgfVxuXG4gICAgLy8gaWYoZGF0ZSA9PT0gbWluRGF0ZVxuICAgIC8vICAgICB8fCBkYXRlID09PSBtYXhEYXRlKSB7XG4gICAgLy8gICBhdmFpbGFibGUgPSB0cnVlO1xuICAgIC8vIH1cblxuICAgIGlmIChkYXRlID49IG1pbkRhdGUgJiYgZGF0ZSA8PSBtYXhEYXRlKSB7XG4gICAgICBpZiAoZGF0ZUFycmF5Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgYXZhaWxhYmxlID0gXy5zb21lKGRhdGVBcnJheSwgKGQpID0+IHtcbiAgICAgICAgICBsZXQgZm9ybWF0ID0gbnVsbDtcbiAgICAgICAgICBpZiAoaXNOYU4oTnVtYmVyKGRhdGUpKSkge1xuICAgICAgICAgICAgaWYgKGlucHV0RGF0ZUZvcm1hdCkge1xuICAgICAgICAgICAgICBmb3JtYXQgPSBpbnB1dERhdGVGb3JtYXQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBmb3JtYXQgPSBtb21lbnQoZGF0ZSkuX2Y7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBtb21lbnQoZCwgZm9ybWF0KS52YWx1ZU9mKCkgPT09IGRhdGU7XG4gICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgYXZhaWxhYmxlID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKGF2YWlsYWJsZSkge1xuICAgICAgICBpZiAoZGlzYWJsZVdlZWtlbmRzKSB7XG4gICAgICAgICAgYXZhaWxhYmxlID0gIXRoaXMuaXNXZWVrZW5kKGRhdGUpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChkaXNhYmxlV2Vla2RheXMpIHtcbiAgICAgICAgICBhdmFpbGFibGUgPSAhdGhpcy5pc1dlZWtkYXkoZGF0ZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGF2YWlsYWJsZTtcbiAgfVxuXG4gIGlzRGF0ZUluUmFuZ2UoZGF0ZSwgbWluRGF0ZSwgbWF4RGF0ZSwgc3RhcnREYXRlLCBlbmREYXRlLCBtb250aFN0YXJ0RGF0ZSwgbW9udGhFbmREYXRlLCBhdmFpbGFibGUsIGNvbmZpZyk6IGJvb2xlYW4ge1xuICAgIGxldCBpblJhbmdlID0gZmFsc2U7XG4gICAgY29uc3QgdHlwZSA9IGNvbmZpZy50eXBlO1xuICAgIGNvbnN0IHNpbmdsZURhdGVQaWNrZXIgPSBjb25maWcuc2luZ2xlRGF0ZVBpY2tlcjtcbiAgICBpZiAoIXNpbmdsZURhdGVQaWNrZXIpIHtcbiAgICAgIGlmICh0eXBlID09PSBcImRhaWx5XCIpIHtcbiAgICAgICAgbWluRGF0ZSA9IG1vbnRoU3RhcnREYXRlO1xuICAgICAgICBtYXhEYXRlID0gbW9udGhFbmREYXRlO1xuICAgICAgfVxuICAgICAgaWYgKGRhdGUgPj0gc3RhcnREYXRlICYmIGRhdGUgPD0gZW5kRGF0ZSAmJiBkYXRlID49IG1pbkRhdGUgJiYgZGF0ZSA8PSBtYXhEYXRlKSB7XG4gICAgICAgIGlmIChhdmFpbGFibGUpIHtcbiAgICAgICAgICBpblJhbmdlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gaW5SYW5nZTtcbiAgfVxuXG4gIGlzRGF0ZUFjdGl2ZShkYXRlLCBzdGFydERhdGUsIGVuZERhdGUsIHNpZGUpOiBib29sZWFuIHtcbiAgICBsZXQgYWN0aXZlID0gZmFsc2U7XG4gICAgaWYgKChkYXRlID09PSBzdGFydERhdGUgJiYgc2lkZSA9PT0gXCJsZWZ0XCIpIHx8IChkYXRlID09PSBlbmREYXRlICYmIHNpZGUgPT09IFwicmlnaHRcIikpIHtcbiAgICAgIGFjdGl2ZSA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiBhY3RpdmU7XG4gIH1cblxuICBpc0RhdGVUb2RheShkYXRlLCBjb25maWcpOiBib29sZWFuIHtcbiAgICBsZXQgdG9kYXkgPSBmYWxzZTtcbiAgICBjb25zdCB0b2RheURhdGUgPSBtb21lbnQoKVxuICAgICAgLnN0YXJ0T2YoXCJkYXlcIilcbiAgICAgIC52YWx1ZU9mKCk7XG4gICAgY29uc3QgdHlwZSA9IGNvbmZpZy50eXBlO1xuICAgIGNvbnN0IGZpcnN0TGFzdERheSA9IHRoaXMuZ2V0Rmlyc3RMYXN0RGF5KG1vbWVudCh0b2RheURhdGUpLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKSwgdHlwZSk7XG4gICAgY29uc3QgZmlyc3REYXkgPSBtb21lbnQoZmlyc3RMYXN0RGF5LmZpcnN0RGF5LCBERUZBVUxUX0RBVEVfRlJPTUFUKS52YWx1ZU9mKCk7XG4gICAgY29uc3QgbGFzdERheSA9IG1vbWVudChmaXJzdExhc3REYXkubGFzdERheSwgREVGQVVMVF9EQVRFX0ZST01BVCkudmFsdWVPZigpO1xuICAgIGlmIChkYXRlID49IGZpcnN0RGF5ICYmIGRhdGUgPD0gbGFzdERheSkge1xuICAgICAgdG9kYXkgPSB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gdG9kYXk7XG4gIH1cblxuICBpc1dlZWtkYXkoZGF0ZSwgZm9ybWF0Pykge1xuICAgIHJldHVybiAhdGhpcy5pc1dlZWtlbmQoZGF0ZSwgZm9ybWF0KTtcbiAgfVxuXG4gIGlzV2Vla2VuZChkYXRlLCBmb3JtYXQ/KSB7XG4gICAgaWYgKCFmb3JtYXQpIHtcbiAgICAgIGZvcm1hdCA9IG51bGw7XG4gICAgfVxuICAgIGNvbnN0IGRheSA9IG1vbWVudChkYXRlLCBmb3JtYXQpLmRheSgpO1xuICAgIHJldHVybiBkYXkgPT09IDAgfHwgZGF5ID09PSA2ID8gdHJ1ZSA6IGZhbHNlO1xuICB9XG5cbiAgZ2V0Q2FsZW5kYXJSb3dWYXJpYWJsZXMob3B0aW9ucykge1xuICAgIGNvbnN0IHZhcmlhYmxlczogYW55ID0ge307XG4gICAgY29uc3QgdHlwZSA9IG9wdGlvbnMudHlwZTtcbiAgICBjb25zdCBtb250aFN0YXJ0V2Vla051bWJlciA9IG9wdGlvbnMubW9udGhTdGFydFdlZWtOdW1iZXI7XG4gICAgY29uc3QgZGF0ZVJvd3MgPSBvcHRpb25zLmRhdGVSb3dzO1xuICAgIGNvbnN0IHllYXIgPSBgJHtvcHRpb25zLnllYXJ9YDtcblxuICAgIGlmICh0eXBlID09PSBcImRhaWx5XCIpIHtcbiAgICAgIHZhcmlhYmxlcy5yb3dOdW1iZXIgPSBtb250aFN0YXJ0V2Vla051bWJlciArIGRhdGVSb3dzO1xuICAgICAgdmFyaWFibGVzLmNvbHVtbnMgPSA2O1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJ3ZWVrbHlcIikge1xuICAgICAgLy8gdmFyaWFibGVzLnJvd051bWJlciA9IGAkeyhkYXRlUm93cyoyKSsxfSAtICR7KGRhdGVSb3dzKjIpKzJ9YDtcbiAgICAgIHZhcmlhYmxlcy5yb3dOdW1iZXIgPSBgYDtcbiAgICAgIHZhcmlhYmxlcy5jb2x1bW5zID0gNjtcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwibW9udGhseVwiKSB7XG4gICAgICB2YXJpYWJsZXMucm93TnVtYmVyID0gZGF0ZVJvd3MgKyAxO1xuICAgICAgdmFyaWFibGVzLmNvbHVtbnMgPSAyO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJxdWFydGVybHlcIikge1xuICAgICAgdmFyaWFibGVzLnJvd051bWJlciA9IHllYXIuY2hhckF0KGRhdGVSb3dzKTtcbiAgICAgIHZhcmlhYmxlcy5jb2x1bW5zID0gMDtcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwieWVhcmx5XCIpIHtcbiAgICAgIHZhcmlhYmxlcy5yb3dOdW1iZXIgPSBcIlwiO1xuICAgICAgdmFyaWFibGVzLmNvbHVtbnMgPSAwO1xuICAgIH1cblxuICAgIHJldHVybiB2YXJpYWJsZXM7XG4gIH1cblxuICBnZXRDYWxlbmRhclJvd0l0ZW1WYXJpYWJsZXMob3B0aW9ucykge1xuICAgIGNvbnN0IHZhcmlhYmxlczogYW55ID0ge1xuICAgICAgY3VycmVudEl0ZW1EYXRlOiBcIlwiLFxuICAgICAgcm93SXRlbVRleHQ6IFwiXCIsXG4gICAgICBpdGVtQ291bnQ6IG51bGxcbiAgICB9O1xuICAgIGNvbnN0IHR5cGUgPSBvcHRpb25zLnR5cGU7XG4gICAgY29uc3QgbW9udGhTdGFydFdlZWtOdW1iZXIgPSBvcHRpb25zLm1vbnRoU3RhcnRXZWVrTnVtYmVyO1xuICAgIGNvbnN0IHllYXJTdGFydERhdGUgPSBvcHRpb25zLnllYXJTdGFydERhdGU7XG4gICAgY29uc3QgeWVhciA9IG9wdGlvbnMueWVhcjtcbiAgICBjb25zdCByb3dJdGVtID0gb3B0aW9ucy5yb3dJdGVtO1xuICAgIGNvbnN0IGRhdGVSb3dzID0gb3B0aW9ucy5kYXRlUm93cztcbiAgICBjb25zdCBjb2x1bW5zID0gb3B0aW9ucy5jb2x1bW5zO1xuICAgIGNvbnN0IGl0ZW1Db3VudCA9IHJvd0l0ZW0gKyBkYXRlUm93cyAqIGNvbHVtbnMgKyBkYXRlUm93cztcbiAgICBsZXQgY3VycmVudEl0ZW1EYXRlID0gXCJcIjtcbiAgICBsZXQgcm93SXRlbVRleHQgPSBcIlwiO1xuICAgIGxldCBmaXJzdExhc3REYXlPYmplY3Q6IGFueSA9IHt9O1xuXG4gICAgaWYgKHR5cGUgPT09IFwiZGFpbHlcIikge1xuICAgICAgaWYgKCFfLmlzTmlsKG1vbnRoU3RhcnRXZWVrTnVtYmVyKSAmJiAhXy5pc05pbChkYXRlUm93cykgJiYgIV8uaXNOaWwoeWVhcikpIHtcbiAgICAgICAgY29uc3QgeWVhclN0YXJ0RGF0ZURhaWx5ID0gbW9tZW50KClcbiAgICAgICAgICAueWVhcih5ZWFyKVxuICAgICAgICAgIC5zdGFydE9mKFwieWVhclwiKVxuICAgICAgICAgIC5mb3JtYXQoREVGQVVMVF9EQVRFX0ZST01BVCk7XG4gICAgICAgIGN1cnJlbnRJdGVtRGF0ZSA9IG1vbWVudCh5ZWFyU3RhcnREYXRlRGFpbHksIERFRkFVTFRfREFURV9GUk9NQVQpXG4gICAgICAgICAgLmFkZChtb250aFN0YXJ0V2Vla051bWJlciArIGRhdGVSb3dzIC0gMSwgXCJ3ZWVrXCIpXG4gICAgICAgICAgLnN0YXJ0T2YoXCJ3ZWVrXCIpXG4gICAgICAgICAgLmFkZChyb3dJdGVtLCBcImRheVwiKVxuICAgICAgICAgIC5mb3JtYXQoREVGQVVMVF9EQVRFX0ZST01BVCk7XG4gICAgICAgIHJvd0l0ZW1UZXh0ID0gbW9tZW50KGN1cnJlbnRJdGVtRGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVCkuZm9ybWF0KFwiRFwiKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwid2Vla2x5XCIpIHtcbiAgICAgIGlmICghXy5pc05pbCh5ZWFyU3RhcnREYXRlKSAmJiAhXy5pc05pbChpdGVtQ291bnQpKSB7XG4gICAgICAgIGN1cnJlbnRJdGVtRGF0ZSA9IG1vbWVudCh5ZWFyU3RhcnREYXRlLCBERUZBVUxUX0RBVEVfRlJPTUFUKVxuICAgICAgICAgIC5hZGQoaXRlbUNvdW50LCBcIndlZWtcIilcbiAgICAgICAgICAuZW5kT2YoXCJ3ZWVrXCIpXG4gICAgICAgICAgLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKTtcbiAgICAgICAgY29uc3Qgd2Vla051bWJlcjogYW55ID0gaXRlbUNvdW50ICsgMTtcbiAgICAgICAgcm93SXRlbVRleHQgPSBgVyR7d2Vla051bWJlcn1gO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJtb250aGx5XCIpIHtcbiAgICAgIGlmICghXy5pc05pbChpdGVtQ291bnQpICYmICFfLmlzTmlsKHllYXIpKSB7XG4gICAgICAgIGN1cnJlbnRJdGVtRGF0ZSA9IG1vbWVudCgpXG4gICAgICAgICAgLnllYXIoeWVhcilcbiAgICAgICAgICAubW9udGgoaXRlbUNvdW50KVxuICAgICAgICAgIC5lbmRPZihcIm1vbnRoXCIpXG4gICAgICAgICAgLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKTtcbiAgICAgICAgcm93SXRlbVRleHQgPSBtb21lbnQoY3VycmVudEl0ZW1EYXRlLCBERUZBVUxUX0RBVEVfRlJPTUFUKS5mb3JtYXQoXCJNTU1cIik7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBcInF1YXJ0ZXJseVwiKSB7XG4gICAgICBpZiAoIV8uaXNOaWwoaXRlbUNvdW50KSAmJiAhXy5pc05pbCh5ZWFyKSkge1xuICAgICAgICBjdXJyZW50SXRlbURhdGUgPSBtb21lbnQoKVxuICAgICAgICAgIC55ZWFyKHllYXIpXG4gICAgICAgICAgLnF1YXJ0ZXIoaXRlbUNvdW50ICsgMSlcbiAgICAgICAgICAuZW5kT2YoXCJxdWFydGVyXCIpXG4gICAgICAgICAgLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKTtcbiAgICAgICAgcm93SXRlbVRleHQgPSBgUXVhcnRlciAke2l0ZW1Db3VudCArIDF9YDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmaXJzdExhc3REYXlPYmplY3QgPSB0aGlzLmdldEZpcnN0TGFzdERheShjdXJyZW50SXRlbURhdGUsIHR5cGUpO1xuXG4gICAgdmFyaWFibGVzLml0ZW1Db3VudCA9IGl0ZW1Db3VudDtcbiAgICB2YXJpYWJsZXMuY3VycmVudEl0ZW1EYXRlID0gY3VycmVudEl0ZW1EYXRlO1xuICAgIHZhcmlhYmxlcy5yb3dJdGVtVGV4dCA9IHJvd0l0ZW1UZXh0O1xuICAgIHZhcmlhYmxlcy5maXJzdERheSA9IGZpcnN0TGFzdERheU9iamVjdC5maXJzdERheTtcbiAgICB2YXJpYWJsZXMubGFzdERheSA9IGZpcnN0TGFzdERheU9iamVjdC5sYXN0RGF5O1xuICAgIHJldHVybiB2YXJpYWJsZXM7XG4gIH1cblxuICBpc1Jvd0llbVZhbGlkKG9wdGlvbnMpOiBib29sZWFuIHtcbiAgICBsZXQgdmFsaWQgPSBmYWxzZTtcbiAgICBjb25zdCB0eXBlID0gb3B0aW9ucy50eXBlO1xuICAgIGNvbnN0IHllYXIgPSBvcHRpb25zLnllYXI7XG4gICAgY29uc3QgaXRlbUNvdW50ID0gb3B0aW9ucy5pdGVtQ291bnQ7XG4gICAgY29uc3QgcmV0YWlsQ2FsZW5kYXIgPSBvcHRpb25zLnJldGFpbENhbGVuZGFyO1xuICAgIGNvbnN0IHZhbGlkV2Vla0NvdW50ID0gdGhpcy5nZXRZZWFybHlXZWVrQ291bnQoeWVhciwgcmV0YWlsQ2FsZW5kYXIpO1xuXG4gICAgaWYgKHR5cGUgPT09IFwiZGFpbHlcIikge1xuICAgICAgdmFsaWQgPSB0cnVlO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJ3ZWVrbHlcIikge1xuICAgICAgaWYgKGl0ZW1Db3VudCA8IHZhbGlkV2Vla0NvdW50KSB7XG4gICAgICAgIHZhbGlkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwibW9udGhseVwiKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwicXVhcnRlcmx5XCIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIHJldHVybiB2YWxpZDtcbiAgfVxuXG4gIGZvcm1hdFN0YXJ0RGF0ZShjb25maWcsIHJldHVybkZvcm1hdCkge1xuICAgIGNvbnN0IHN0YXJ0RGF0ZSA9IGNvbmZpZyA/IGNvbmZpZy5zdGFydERhdGUgOiBudWxsO1xuICAgIGNvbnN0IHR5cGUgPSBjb25maWcgPyBjb25maWcudHlwZSA6IFwiXCI7XG4gICAgbGV0IGZvcm1hdHRlZFN0YXJ0RGF0ZSA9IG51bGw7XG5cbiAgICBpZiAoc3RhcnREYXRlKSB7XG4gICAgICBmb3JtYXR0ZWRTdGFydERhdGUgPSBtb21lbnQoc3RhcnREYXRlLCBERUZBVUxUX0RBVEVfRlJPTUFUKS5mb3JtYXQocmV0dXJuRm9ybWF0KTtcbiAgICAgIGlmICh0eXBlID09PSBcIndlZWtseVwiKSB7XG4gICAgICAgIGZvcm1hdHRlZFN0YXJ0RGF0ZSA9IG1vbWVudChzdGFydERhdGUsIERFRkFVTFRfREFURV9GUk9NQVQpXG4gICAgICAgICAgLnN0YXJ0T2YoXCJ3ZWVrXCIpXG4gICAgICAgICAgLmZvcm1hdChyZXR1cm5Gb3JtYXQpO1xuICAgICAgfSBlbHNlIGlmICh0eXBlID09PSBcIm1vbnRobHlcIikge1xuICAgICAgICBmb3JtYXR0ZWRTdGFydERhdGUgPSBtb21lbnQoc3RhcnREYXRlLCBERUZBVUxUX0RBVEVfRlJPTUFUKVxuICAgICAgICAgIC5zdGFydE9mKFwibW9udGhcIilcbiAgICAgICAgICAuZm9ybWF0KHJldHVybkZvcm1hdCk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwicXVhcnRlcmx5XCIpIHtcbiAgICAgICAgZm9ybWF0dGVkU3RhcnREYXRlID0gbW9tZW50KHN0YXJ0RGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVClcbiAgICAgICAgICAuc3RhcnRPZihcInF1YXJ0ZXJcIilcbiAgICAgICAgICAuZm9ybWF0KHJldHVybkZvcm1hdCk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwieWVhcmx5XCIpIHtcbiAgICAgICAgZm9ybWF0dGVkU3RhcnREYXRlID0gbW9tZW50KHN0YXJ0RGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVClcbiAgICAgICAgICAuc3RhcnRPZihcInllYXJcIilcbiAgICAgICAgICAuZm9ybWF0KHJldHVybkZvcm1hdCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGZvcm1hdHRlZFN0YXJ0RGF0ZTtcbiAgfVxuXG4gIGdldFNlbGVjdGVkWWVhcihjb25maWcsIGRhdGUsIHNpZGUpOiBzdHJpbmcge1xuICAgIHJldHVybiBtb21lbnQoZGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVCkuZm9ybWF0KFwiWVlZWVwiKTtcbiAgfVxuXG4gIGdldEZpcnN0TGFzdERheShkYXRlLCB0eXBlKSB7XG4gICAgbGV0IGZpcnN0RGF5ID0gXCJcIjtcbiAgICBsZXQgbGFzdERheSA9IFwiXCI7XG5cbiAgICBpZiAodHlwZSA9PT0gXCJkYWlseVwiKSB7XG4gICAgICBmaXJzdERheSA9IGxhc3REYXkgPSBkYXRlO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJ3ZWVrbHlcIikge1xuICAgICAgZmlyc3REYXkgPSBtb21lbnQoZGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVClcbiAgICAgICAgLnN0YXJ0T2YoXCJ3ZWVrXCIpXG4gICAgICAgIC5mb3JtYXQoREVGQVVMVF9EQVRFX0ZST01BVCk7XG4gICAgICBsYXN0RGF5ID0gbW9tZW50KGRhdGUsIERFRkFVTFRfREFURV9GUk9NQVQpXG4gICAgICAgIC5lbmRPZihcIndlZWtcIilcbiAgICAgICAgLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKTtcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwibW9udGhseVwiKSB7XG4gICAgICBmaXJzdERheSA9IG1vbWVudChkYXRlLCBERUZBVUxUX0RBVEVfRlJPTUFUKVxuICAgICAgICAuc3RhcnRPZihcIm1vbnRoXCIpXG4gICAgICAgIC5mb3JtYXQoREVGQVVMVF9EQVRFX0ZST01BVCk7XG4gICAgICBsYXN0RGF5ID0gbW9tZW50KGRhdGUsIERFRkFVTFRfREFURV9GUk9NQVQpXG4gICAgICAgIC5lbmRPZihcIm1vbnRoXCIpXG4gICAgICAgIC5mb3JtYXQoREVGQVVMVF9EQVRFX0ZST01BVCk7XG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBcInF1YXJ0ZXJseVwiKSB7XG4gICAgICBmaXJzdERheSA9IG1vbWVudChkYXRlLCBERUZBVUxUX0RBVEVfRlJPTUFUKVxuICAgICAgICAuc3RhcnRPZihcInF1YXJ0ZXJcIilcbiAgICAgICAgLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKTtcbiAgICAgIGxhc3REYXkgPSBtb21lbnQoZGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVClcbiAgICAgICAgLmVuZE9mKFwicXVhcnRlclwiKVxuICAgICAgICAuZm9ybWF0KERFRkFVTFRfREFURV9GUk9NQVQpO1xuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJ5ZWFybHlcIikge1xuICAgICAgZmlyc3REYXkgPSBtb21lbnQoZGF0ZSwgREVGQVVMVF9EQVRFX0ZST01BVClcbiAgICAgICAgLnN0YXJ0T2YoXCJ5ZWFyXCIpXG4gICAgICAgIC5mb3JtYXQoREVGQVVMVF9EQVRFX0ZST01BVCk7XG4gICAgICBsYXN0RGF5ID0gbW9tZW50KGRhdGUsIERFRkFVTFRfREFURV9GUk9NQVQpXG4gICAgICAgIC5lbmRPZihcInllYXJcIilcbiAgICAgICAgLmZvcm1hdChERUZBVUxUX0RBVEVfRlJPTUFUKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgZmlyc3REYXksXG4gICAgICBsYXN0RGF5XG4gICAgfTtcbiAgfVxuXG4gIGdldExvY2FsVGltZXpvbmUoKSB7XG4gICAgbGV0IHR6ID0gL1xcKCguKilcXCkvLmV4ZWMobmV3IERhdGUoKS50b1N0cmluZygpKVsxXTtcblxuICAgIGlmICh0eiA9PT0gXCJDZW50cmFsIEV1cm9wZSBTdGFuZGFyZCBUaW1lXCIpIHtcbiAgICAgIHR6ID0gRVVfVFpfQ09ERTtcbiAgICB9IGVsc2Uge1xuICAgICAgdHogPSBERUZBVUxUX1RJTUVaT05FX0NPREU7XG4gICAgfVxuXG4gICAgcmV0dXJuIHR6O1xuICB9XG5cbiAgZ2V0Wm9uZURhdGUodHosIGZvcm1hdCwgZGF0ZT8pIHtcbiAgICBpZiAoZGF0ZSkge1xuICAgICAgZGF0ZSA9IG1vbWVudChkYXRlLCBmb3JtYXQpXG4gICAgICAgIC5zdGFydE9mKFwiZGF5XCIpXG4gICAgICAgIC52YWx1ZU9mKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGRhdGUgPSBtb21lbnQoKS52YWx1ZU9mKCk7XG4gICAgfVxuXG4gICAgbGV0IHRvZGF5ID0gbmV3IERhdGUoZGF0ZSkudG9Mb2NhbGVTdHJpbmcoXCJlbi1VU1wiLCB7XG4gICAgICB0aW1lWm9uZTogVFpfTkFNRVNbdHpdXG4gICAgfSk7XG4gICAgdG9kYXkgPSBtb21lbnQodG9kYXksIFwiTU0vREQvWVlZWSwgaGg6bW06c3MgQVwiKTtcbiAgICByZXR1cm4gdG9kYXk7XG4gIH1cblxuICBnZXRab25lVG9kYXkodHosIHZpZXdEYXRlRm9ybWF0KSB7XG4gICAgY29uc3QgdG9kYXkgPSB0aGlzLmdldFpvbmVEYXRlKHR6LCB2aWV3RGF0ZUZvcm1hdCk7XG4gICAgcmV0dXJuIG1vbWVudCh0b2RheSkuZm9ybWF0KGAke3ZpZXdEYXRlRm9ybWF0fSAgaGg6bW0gQWApO1xuICB9XG5cbiAgZm9ybWF0VG9ab25lRGF0ZSh0eiwgZm9ybWF0LCBkYXRlKSB7XG4gICAgY29uc3QgZm9ybWF0dGVkRGF0ZSA9IHRoaXMuZ2V0Wm9uZURhdGUodHosIGZvcm1hdCwgZGF0ZSk7XG4gICAgcmV0dXJuIG1vbWVudChmb3JtYXR0ZWREYXRlKS5mb3JtYXQoYCR7Zm9ybWF0fWApO1xuICB9XG5cbiAgY29udmVydFRvVmlld1RpbWVJdGVtKGl0ZW0pIHtcbiAgICBsZXQgc3RyaW5naWZpZWRfaXRlbSA9IGl0ZW0gKyBcIlwiO1xuICAgIGlmIChzdHJpbmdpZmllZF9pdGVtLmxlbmd0aCA9PT0gMSkge1xuICAgICAgc3RyaW5naWZpZWRfaXRlbSA9IGAwJHtzdHJpbmdpZmllZF9pdGVtfWA7XG4gICAgfVxuICAgIHJldHVybiBzdHJpbmdpZmllZF9pdGVtO1xuICB9XG5cbiAgZ2V0V2Vla051bWJlcihkYXRlKTogYW55IHtcbiAgICBpZiAoZGF0ZSkge1xuICAgICAgY29uc3QgeWVhciA9IG1vbWVudChkYXRlLCBcIllZWVktTU0tRERcIikueWVhcigpO1xuICAgICAgY29uc3QgbW9udGggPSBtb21lbnQoZGF0ZSwgXCJZWVlZLU1NLUREXCIpLm1vbnRoKCk7XG4gICAgICBjb25zdCBkYXkgPSBOdW1iZXIobW9tZW50KGRhdGUsIFwiWVlZWS1NTS1ERFwiKS5mb3JtYXQoXCJEXCIpKTtcblxuICAgICAgY29uc3QgeWVhclN0YXJ0bXMgPSBuZXcgRGF0ZSh5ZWFyLCAwLCAxKTtcbiAgICAgIGNvbnN0IGRhdGVtcyA9IG5ldyBEYXRlKHllYXIsIG1vbnRoLCBkYXkpO1xuICAgICAgcmV0dXJuIE1hdGguY2VpbCgoKGRhdGVtcy5nZXRUaW1lKCkgLSB5ZWFyU3RhcnRtcy5nZXRUaW1lKCkpIC8gODY0MDAwMDAgKyB5ZWFyU3RhcnRtcy5nZXREYXkoKSArIDEpIC8gNyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUud2FybihcImdldFdlZWtOdW1iZXI6IEludmFsaWQgZGF0ZVwiKTtcbiAgICAgIHJldHVybiB0aGlzLmdldE5vdEF2YWlsYWJsZVRleHQoKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==